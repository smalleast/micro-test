{"version":3,"file":"jsx-custom-event.js","sources":["../src/polyfill/jsx-custom-event.ts"],"sourcesContent":["// @ts-ignore\nimport React from 'react'\n\ntype MicroElementType = HTMLElement & Record<string, unknown>\n\n// lifecycles\nconst eventLifeCycles = ['oncreated', 'onbeforemount', 'onmounted', 'onunmount', 'onerror', 'ondatachange']\n\nexport default function jsxCustomEvent (\n  type: string | CallableFunction,\n  props: Record<string, unknown> | null,\n  ...children: any[]\n): void {\n  const newProps = Object.assign({}, props)\n\n  if (/^micro-app(-\\S+)?/.test(type as string) && props) {\n    // ref will call when create, update, unmount\n    newProps.ref = (element: MicroElementType | null) => {\n      if (typeof props.ref === 'function') {\n        props.ref(element)\n      } else if (typeof props.ref === 'object') {\n        (props.ref as any).current = element\n      }\n\n      // when unmount and update the element is null\n      if (element) {\n        // Update data when the prev and next data are different\n        if (toString.call(props.data) === '[object Object]' && element.data !== props.data) {\n          element.data = props.data\n        }\n\n        for (const key in props) {\n          if (\n            Object.prototype.hasOwnProperty.call(props, key) &&\n            eventLifeCycles.includes(key.toLowerCase()) &&\n            typeof props[key] === 'function' &&\n            (!element[key] || element[key] !== props[key])\n          ) {\n            const eventName = key.toLowerCase().replace('on', '')\n            if (element[key]) {\n              // @ts-ignore\n              element.removeEventListener(eventName, element[key], false)\n            }\n            // @ts-ignore\n            element.addEventListener(eventName, props[key], false)\n            element[key] = props[key]\n          }\n        }\n      }\n    }\n  }\n\n  return React.createElement.apply(null, [type, newProps, ...children])\n}\n"],"names":[],"mappings":";;AAAA;AAKA;AACA,MAAM,eAAe,GAAG,CAAC,WAAW,EAAE,eAAe,EAAE,WAAW,EAAE,WAAW,EAAE,SAAS,EAAE,cAAc,CAAC,CAAA;SAEnF,cAAc,CACpC,IAA+B,EAC/B,KAAqC,EACrC,GAAG,QAAe;IAElB,MAAM,QAAQ,GAAG,MAAM,CAAC,MAAM,CAAC,EAAE,EAAE,KAAK,CAAC,CAAA;IAEzC,IAAI,mBAAmB,CAAC,IAAI,CAAC,IAAc,CAAC,IAAI,KAAK,EAAE;;QAErD,QAAQ,CAAC,GAAG,GAAG,CAAC,OAAgC;YAC9C,IAAI,OAAO,KAAK,CAAC,GAAG,KAAK,UAAU,EAAE;gBACnC,KAAK,CAAC,GAAG,CAAC,OAAO,CAAC,CAAA;aACnB;iBAAM,IAAI,OAAO,KAAK,CAAC,GAAG,KAAK,QAAQ,EAAE;gBACvC,KAAK,CAAC,GAAW,CAAC,OAAO,GAAG,OAAO,CAAA;aACrC;;YAGD,IAAI,OAAO,EAAE;;gBAEX,IAAI,QAAQ,CAAC,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,KAAK,iBAAiB,IAAI,OAAO,CAAC,IAAI,KAAK,KAAK,CAAC,IAAI,EAAE;oBAClF,OAAO,CAAC,IAAI,GAAG,KAAK,CAAC,IAAI,CAAA;iBAC1B;gBAED,KAAK,MAAM,GAAG,IAAI,KAAK,EAAE;oBACvB,IACE,MAAM,CAAC,SAAS,CAAC,cAAc,CAAC,IAAI,CAAC,KAAK,EAAE,GAAG,CAAC;wBAChD,eAAe,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAW,EAAE,CAAC;wBAC3C,OAAO,KAAK,CAAC,GAAG,CAAC,KAAK,UAAU;yBAC/B,CAAC,OAAO,CAAC,GAAG,CAAC,IAAI,OAAO,CAAC,GAAG,CAAC,KAAK,KAAK,CAAC,GAAG,CAAC,CAAC,EAC9C;wBACA,MAAM,SAAS,GAAG,GAAG,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAA;wBACrD,IAAI,OAAO,CAAC,GAAG,CAAC,EAAE;;4BAEhB,OAAO,CAAC,mBAAmB,CAAC,SAAS,EAAE,OAAO,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAAA;yBAC5D;;wBAED,OAAO,CAAC,gBAAgB,CAAC,SAAS,EAAE,KAAK,CAAC,GAAG,CAAC,EAAE,KAAK,CAAC,CAAA;wBACtD,OAAO,CAAC,GAAG,CAAC,GAAG,KAAK,CAAC,GAAG,CAAC,CAAA;qBAC1B;iBACF;aACF;SACF,CAAA;KACF;IAED,OAAO,KAAK,CAAC,aAAa,CAAC,KAAK,CAAC,IAAI,EAAE,CAAC,IAAI,EAAE,QAAQ,EAAE,GAAG,QAAQ,CAAC,CAAC,CAAA;AACvE;;;;"}