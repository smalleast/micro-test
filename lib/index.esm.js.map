{"version":3,"file":"index.esm.js","sources":["../src/libs/utils.ts","../src/constants.ts","../src/libs/global_env.ts","../src/source/scoped_css.ts","../src/source/load_event.ts","../src/source/links.ts","../src/source/scripts.ts","../src/source/patch.ts","../src/libs/additional.ts","../src/interact/lifecycles_event.ts","../src/micro_app_element.ts","../src/interact/event_center.ts","../src/interact/index.ts","../src/micro_app.ts","../src/source/fetch.ts","../src/source/index.ts","../src/sandbox/bind_function.ts","../src/sandbox/effect.ts","../src/sandbox/index.ts","../src/create_app.ts","../src/prefetch.ts"],"sourcesContent":["/* eslint-disable no-new-func, indent */\nimport type { Func } from '@micro-app/types'\n\nexport const version = '__VERSION__'\n\n// do not use isUndefined\nexport const isBrowser = typeof window !== 'undefined'\n\nexport const globalThis =\n  !isUndefined(global)\n    ? global\n    : !isUndefined(window)\n      ? window\n      : !isUndefined(self)\n        ? self\n        : Function('return this')()\n\n// is Undefined\nexport function isUndefined (target: unknown): target is undefined {\n  return target === undefined\n}\n\n// is Null\nexport function isNull (target: unknown): target is null {\n  return target === null\n}\n\n// is String\nexport function isString (target: unknown): target is string {\n  return typeof target === 'string'\n}\n\n// is Boolean\nexport function isBoolean (target: unknown): target is boolean {\n  return typeof target === 'boolean'\n}\n\n// is function\nexport function isFunction (target: unknown): boolean {\n  return typeof target === 'function'\n}\n\n// is Array\nexport const isArray = Array.isArray\n\n// is PlainObject\nexport function isPlainObject (target: unknown): boolean {\n  return toString.call(target) === '[object Object]'\n}\n\n// is Promise\nexport function isPromise (target: unknown): boolean {\n  return toString.call(target) === '[object Promise]'\n}\n\n/**\n * format error log\n * @param msg message\n * @param appName app name, default is null\n */\nexport function logError (\n  msg: unknown,\n  appName: string | null = null,\n  ...rest: any[]\n): void {\n  const appNameTip = appName && isString(appName) ? ` app ${appName}:` : ''\n  if (isString(msg)) {\n    console.error(`[micro-app]${appNameTip} ${msg}`, ...rest)\n  } else {\n    console.error(`[micro-app]${appNameTip}`, msg, ...rest)\n  }\n}\n\n/**\n * format warn log\n * @param msg message\n * @param appName app name, default is null\n */\nexport function logWarn (\n  msg: unknown,\n  appName: string | null = null,\n  ...rest: any[]\n): void {\n  const appNameTip = appName && isString(appName) ? ` app ${appName}:` : ''\n  if (isString(msg)) {\n    console.warn(`[micro-app]${appNameTip} ${msg}`, ...rest)\n  } else {\n    console.warn(`[micro-app]${appNameTip}`, msg, ...rest)\n  }\n}\n\n/**\n * async execution\n * @param fn callback\n * @param args params\n */\nexport function defer (fn: Func, ...args: any[]): void {\n  Promise.resolve().then(fn.bind(null, ...args))\n}\n\n/**\n * Add address protocol\n * @param url address\n */\nexport function addProtocol (url: string): string {\n  return url.startsWith('//') ? `${location.protocol}${url}` : url\n}\n\n/**\n * Format URL address\n * @param url address\n */\nexport function formatURL (url: string | null, appName: string | null = null): string {\n  if (!isString(url) || !url) return ''\n\n  try {\n    const { origin, pathname, search } = new URL(addProtocol(url))\n    // If it ends with .html/.node/.php/.net/.etc, donâ€™t need to add /\n    if (/\\.(\\w+)$/.test(pathname)) {\n      return `${origin}${pathname}${search}`\n    }\n    const fullPath = `${origin}${pathname}/`.replace(/\\/\\/$/, '/')\n    return /^https?:\\/\\//.test(fullPath) ? `${fullPath}${search}` : ''\n  } catch (e) {\n    logError(e, appName)\n    return ''\n  }\n}\n\n/**\n * Get valid address, such as https://xxx/xx/xx.html to https://xxx/xx/\n * @param url app.url\n */\nexport function getEffectivePath (url: string): string {\n  const { origin, pathname } = new URL(url)\n  if (/\\.(\\w+)$/.test(pathname)) {\n    const fullPath = `${origin}${pathname}`\n    const pathArr = fullPath.split('/')\n    pathArr.pop()\n    return pathArr.join('/') + '/'\n  }\n\n  return `${origin}${pathname}/`.replace(/\\/\\/$/, '/')\n}\n\n/**\n * Complete address\n * @param path address\n * @param baseURI base url(app.url)\n */\nexport function CompletionPath (path: string, baseURI: string): string {\n  if (\n    !path ||\n    /^((((ht|f)tps?)|file):)?\\/\\//.test(path) ||\n    /^(data|blob):/.test(path)\n  ) return path\n\n  return new URL(path, getEffectivePath(addProtocol(baseURI))).toString()\n}\n\n/**\n * Get the folder where the link resource is located,\n * which is used to complete the relative address in the css\n * @param linkpath full link address\n */\nexport function getLinkFileDir (linkpath: string): string {\n  const pathArr = linkpath.split('/')\n  pathArr.pop()\n  return addProtocol(pathArr.join('/') + '/')\n}\n\n/**\n * promise stream\n * @param promiseList promise list\n * @param successCb success callback\n * @param errorCb failed callback\n * @param finallyCb finally callback\n */\nexport function promiseStream <T> (\n  promiseList: Array<Promise<T> | T>,\n  successCb: CallableFunction,\n  errorCb: CallableFunction,\n  finallyCb?: CallableFunction,\n): void {\n  let finishedNum = 0\n\n  function isFinished () {\n    if (++finishedNum === promiseList.length && finallyCb) finallyCb()\n  }\n\n  promiseList.forEach((p, i) => {\n    if (isPromise(p)) {\n      (p as Promise<T>).then((res: T) => {\n        successCb({\n          data: res,\n          index: i,\n        })\n        isFinished()\n      }).catch((err: Error) => {\n        errorCb({\n          error: err,\n          index: i,\n        })\n        isFinished()\n      })\n    } else {\n      successCb({\n        data: p,\n        index: i,\n      })\n      isFinished()\n    }\n  })\n}\n\n// Check whether the browser supports module script\nexport function isSupportModuleScript (): boolean {\n  const s = document.createElement('script')\n  return 'noModule' in s\n}\n\n// Create a random symbol string\nexport function createNonceSrc (): string {\n  return 'inline-' + Math.random().toString(36).substr(2, 15)\n}\n\n// Array deduplication\nexport function unique (array: any[]): any[] {\n  return array.filter(function (this: Record<PropertyKey, boolean>, item) {\n    return item in this ? false : (this[item] = true)\n  }, Object.create(null))\n}\n\n// requestIdleCallback polyfill\nexport const requestIdleCallback = globalThis.requestIdleCallback ||\n  function (fn: CallableFunction) {\n    const lastTime = Date.now()\n    return setTimeout(function () {\n      fn({\n        didTimeout: false,\n        timeRemaining () {\n          return Math.max(0, 50 - (Date.now() - lastTime))\n        },\n      })\n    }, 1)\n  }\n\n/**\n * Record the currently running app.name\n */\nlet currentMicroAppName: string | null = null\nexport function setCurrentAppName (appName: string | null): void {\n  currentMicroAppName = appName\n}\n\n// get the currently running app.name\nexport function getCurrentAppName (): string | null {\n  return currentMicroAppName\n}\n\n// Clear appName\nexport function removeDomScope (): void {\n  setCurrentAppName(null)\n}\n\n// is safari browser\nexport function isSafari (): boolean {\n  return /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent)\n}\n\n/**\n * Create pure elements\n */\nexport function pureCreateElement<K extends keyof HTMLElementTagNameMap> (tagName: K, options?: ElementCreationOptions): HTMLElementTagNameMap[K] {\n  const element = document.createElement(tagName, options)\n  if (element.__MICRO_APP_NAME__) delete element.__MICRO_APP_NAME__\n  return element\n}\n\n/**\n * clone origin elements to target\n * @param origin Cloned element\n * @param target Accept cloned elements\n * @param deep deep clone or transfer dom\n */\nexport function cloneNode <T extends Element, Q extends Element> (\n  origin: T,\n  target: Q,\n  deep: boolean,\n): void {\n  target.innerHTML = ''\n  if (deep) {\n    const clonedNode = origin.cloneNode(true)\n    const fragment = document.createDocumentFragment()\n    Array.from(clonedNode.childNodes).forEach((node: Node | Element) => {\n      fragment.appendChild(node)\n    })\n    target.appendChild(fragment)\n  } else {\n    Array.from(origin.childNodes).forEach((node: Node | Element) => {\n      target.appendChild(node)\n    })\n  }\n}\n","export enum ObservedAttrName {\n  NAME = 'name',\n  URL = 'url',\n}\n\n// app status\nexport enum appStatus {\n  NOT_LOADED = 'NOT_LOADED',\n  LOADING_SOURCE_CODE = 'LOADING_SOURCE_CODE',\n  LOAD_SOURCE_FINISHED = 'LOAD_SOURCE_FINISHED',\n  LOAD_SOURCE_ERROR = 'LOAD_SOURCE_ERROR',\n  MOUNTING = 'MOUNTING',\n  MOUNTED = 'MOUNTED',\n  UNMOUNT = 'UNMOUNT',\n}\n\n// lifecycles\nexport enum lifeCycles {\n  CREATED = 'created',\n  BEFOREMOUNT = 'beforemount',\n  MOUNTED = 'mounted',\n  UNMOUNT = 'unmount',\n  ERROR = 'error',\n}\n","import { isSupportModuleScript, isBrowser } from './utils'\n\ntype RequestIdleCallbackOptions = {\n  timeout: number\n}\n\ntype RequestIdleCallbackInfo = {\n  readonly didTimeout: boolean\n  timeRemaining: () => number\n}\n\ndeclare global {\n  interface Window {\n    requestIdleCallback (\n      callback: (info: RequestIdleCallbackInfo) => void,\n      opts?: RequestIdleCallbackOptions,\n    ): number\n    _babelPolyfill: boolean\n    proxyWindow?: WindowProxy\n    __MICRO_APP_ENVIRONMENT__?: boolean\n    __MICRO_APP_UMD_MODE__?: boolean\n    __MICRO_APP_BASE_APPLICATION__?: boolean\n  }\n  interface Element {\n    __MICRO_APP_NAME__?: string\n    data?: any\n  }\n  interface Node {\n    __MICRO_APP_NAME__?: string\n  }\n  interface HTMLStyleElement {\n    linkpath?: string\n  }\n}\n\nconst globalEnv: Record<string, any> = {}\n\nexport function initGloalEnv (): void {\n  if (isBrowser) {\n    /**\n     * save patch raw methods\n     * pay attention to this binding\n     */\n    const rawSetAttribute = Element.prototype.setAttribute\n    const rawAppendChild = Node.prototype.appendChild\n    const rawInsertBefore = Node.prototype.insertBefore\n    const rawReplaceChild = Node.prototype.replaceChild\n    const rawRemoveChild = Node.prototype.removeChild\n    const rawAppend = Element.prototype.append\n    const rawPrepend = Element.prototype.prepend\n\n    const rawCreateElement = Document.prototype.createElement\n    const rawCreateElementNS = Document.prototype.createElementNS\n    const rawCreateDocumentFragment = Document.prototype.createDocumentFragment\n    const rawQuerySelector = Document.prototype.querySelector\n    const rawQuerySelectorAll = Document.prototype.querySelectorAll\n    const rawGetElementById = Document.prototype.getElementById\n    const rawGetElementsByClassName = Document.prototype.getElementsByClassName\n    const rawGetElementsByTagName = Document.prototype.getElementsByTagName\n    const rawGetElementsByName = Document.prototype.getElementsByName\n\n    const rawWindow = Function('return window')()\n    const rawDocument = Function('return document')()\n    const supportModuleScript = isSupportModuleScript()\n    const templateStyle: HTMLStyleElement = rawDocument.body.querySelector('#micro-app-template-style')\n\n    /**\n     * save effect raw methods\n     * pay attention to this binding, especially setInterval, setTimeout, clearInterval, clearTimeout\n     */\n    const rawWindowAddEventListener = rawWindow.addEventListener\n    const rawWindowRemoveEventListener = rawWindow.removeEventListener\n    const rawSetInterval = rawWindow.setInterval\n    const rawSetTimeout = rawWindow.setTimeout\n    const rawClearInterval = rawWindow.clearInterval\n    const rawClearTimeout = rawWindow.clearTimeout\n\n    const rawDocumentAddEventListener = rawDocument.addEventListener\n    const rawDocumentRemoveEventListener = rawDocument.removeEventListener\n\n    // mark current application as base application\n    window.__MICRO_APP_BASE_APPLICATION__ = true\n\n    Object.assign(globalEnv, {\n      // source/patch\n      rawSetAttribute,\n      rawAppendChild,\n      rawInsertBefore,\n      rawReplaceChild,\n      rawRemoveChild,\n      rawAppend,\n      rawPrepend,\n      rawCreateElement,\n      rawCreateElementNS,\n      rawCreateDocumentFragment,\n      rawQuerySelector,\n      rawQuerySelectorAll,\n      rawGetElementById,\n      rawGetElementsByClassName,\n      rawGetElementsByTagName,\n      rawGetElementsByName,\n\n      // common global vars\n      rawWindow,\n      rawDocument,\n      supportModuleScript,\n      templateStyle,\n\n      // sandbox/effect\n      rawWindowAddEventListener,\n      rawWindowRemoveEventListener,\n      rawSetInterval,\n      rawSetTimeout,\n      rawClearInterval,\n      rawClearTimeout,\n      rawDocumentAddEventListener,\n      rawDocumentRemoveEventListener,\n    })\n  }\n}\n\nexport default globalEnv\n","import { appInstanceMap } from '../create_app'\nimport { CompletionPath, isSafari, pureCreateElement, getLinkFileDir } from '../libs/utils'\nimport microApp from '../micro_app'\nimport globalEnv from '../libs/global_env'\n\n// https://developer.mozilla.org/zh-CN/docs/Web/API/CSSRule\nenum CSSRuleType {\n  STYLE_RULE = 1,\n  MEDIA_RULE = 4,\n  SUPPORTS_RULE = 12,\n}\n\n/**\n * Bind css scope\n * Special case:\n * 1. html-abc | abc-html\n * 2. html body.abc\n * 3. abchtml | htmlabc | abcbody | bodyabc\n * 4. html + body | html > body | html.body | html[name=xx] | body[name=xx]\n * 5. xxx, html xxx, body xxx\n *\n * TODO: BUG\n  .test-b {\n    border: 1px solid var(--color-a);\n    border-bottom-color: var(--color-b);\n  }\n */\nfunction scopedStyleRule (rule: CSSStyleRule, prefix: string): string {\n  const { selectorText, cssText } = rule\n  if (/^((html[\\s>~,]+body)|(html|body|:root))$/.test(selectorText)) {\n    return cssText.replace(/^((html[\\s>~,]+body)|(html|body|:root))/, prefix)\n  } else if (selectorText === '*') {\n    return cssText.replace('*', `${prefix} *`)\n  }\n\n  const builtInRootSelectorRE = /(^|\\s+)((html[\\s>~]+body)|(html|body|:root))(?=[\\s>~]+|$)/\n\n  return cssText.replace(/^[\\s\\S]+{/, (selectors) => {\n    return selectors.replace(/(^|,)([^,]+)/g, (all, $1, $2) => {\n      if (builtInRootSelectorRE.test($2)) {\n        // body[name=xx]|body.xx|body#xx etc. do not need to handle\n        return all.replace(builtInRootSelectorRE, prefix)\n      }\n      return `${$1} ${prefix} ${$2.replace(/^\\s*/, '')}`\n    })\n  })\n}\n\n/**\n * Complete static resource address\n * @param cssText css content\n * @param baseURI domain name\n * @param textContent origin content\n * @param linkpath link resource address, if it is the style converted from link, it will have linkpath\n */\nfunction scopedHost (\n  cssText: string,\n  baseURI: string,\n  textContent: string,\n  linkpath?: string,\n) {\n  return cssText.replace(/url\\([\"']?([^)\"']+)[\"']?\\)/gm, (all, $1) => {\n    if (/^(data|blob):/.test($1)) {\n      return all\n    } else if (/^(https?:)?\\/\\//.test($1)) {\n      if (isSafari()) {\n        const purePath = $1.replace(/^https?:/, '')\n        if (textContent.indexOf(purePath) === -1) {\n          $1 = $1.replace(window.location.origin, '')\n        } else {\n          return all\n        }\n      } else {\n        return all\n      }\n    }\n\n    // ./a/b.png  ../a/b.png  a/b.png\n    if (/^((\\.\\.?\\/)|[^/])/.test($1) && linkpath) {\n      baseURI = getLinkFileDir(linkpath)\n    }\n\n    return `url(\"${CompletionPath($1, baseURI)}\")`\n  })\n}\n\n// handle media and supports\nfunction scopedPackRule (\n  rule: CSSMediaRule | CSSSupportsRule,\n  prefix: string,\n  packName: string,\n): string {\n  const result = scopedRule(Array.from(rule.cssRules), prefix)\n  return `@${packName} ${rule.conditionText} {${result}}`\n}\n\n/**\n * Process each cssrule\n * @param rules cssRule\n * @param prefix prefix as micro-app[name=xxx]\n */\nfunction scopedRule (rules: CSSRule[], prefix: string): string {\n  let result = ''\n  for (const rule of rules) {\n    switch (rule.type) {\n      case CSSRuleType.STYLE_RULE:\n        result += scopedStyleRule(rule as CSSStyleRule, prefix)\n        break\n      case CSSRuleType.MEDIA_RULE:\n        result += scopedPackRule(rule as CSSMediaRule, prefix, 'media')\n        break\n      case CSSRuleType.SUPPORTS_RULE:\n        result += scopedPackRule(rule as CSSSupportsRule, prefix, 'supports')\n        break\n      default:\n        result += rule.cssText\n        break\n    }\n  }\n\n  return result.replace(/^\\s+/, '')\n}\n\n/**\n * common method of bind CSS\n */\nfunction commonAction (\n  templateStyle: HTMLStyleElement,\n  styleElement: HTMLStyleElement,\n  originContent: string,\n  prefix: string,\n  baseURI: string,\n  linkpath?: string,\n) {\n  const rules: CSSRule[] = Array.from(templateStyle.sheet?.cssRules ?? [])\n  let result = scopedHost(\n    scopedRule(rules, prefix),\n    baseURI,\n    originContent,\n    linkpath,\n  )\n  /**\n   * Solve the problem of missing content quotes in some Safari browsers\n   * docs: https://developer.mozilla.org/zh-CN/docs/Web/CSS/content\n   * If there are still problems, it is recommended to use the attr()\n   */\n  if (isSafari()) {\n    result = result.replace(/([;{]\\s*content:\\s*)([^\\s\"][^\";}]*)/gm, (all, $1, $2) => {\n      if (\n        $2 === 'none' ||\n        /^(url\\()|(counter\\()|(attr\\()|(open-quote)|(close-quote)/.test($2)\n      ) {\n        return all\n      }\n      return `${$1}\"${$2}\"`\n    })\n  }\n  styleElement.textContent = result\n}\n\n/**\n * scopedCSS\n * @param styleElement target style element\n * @param appName app name\n */\nexport default function scopedCSS (styleElement: HTMLStyleElement, appName: string): HTMLStyleElement {\n  const app = appInstanceMap.get(appName)\n  if (app?.scopecss) {\n    const prefix = `${microApp.tagName}[name=${appName}]`\n    let templateStyle = globalEnv.templateStyle\n    if (!templateStyle) {\n      globalEnv.templateStyle = templateStyle = pureCreateElement('style')\n      templateStyle.setAttribute('id', 'micro-app-template-style')\n      globalEnv.rawDocument.body.appendChild(templateStyle)\n      templateStyle.sheet!.disabled = true\n    }\n\n    if (styleElement.textContent) {\n      templateStyle.textContent = styleElement.textContent\n      commonAction(templateStyle, styleElement, styleElement.textContent, prefix, app.url, styleElement.linkpath)\n      templateStyle.textContent = ''\n    } else {\n      const observer = new MutationObserver(function () {\n        observer.disconnect()\n        // styled-component will not be processed temporarily\n        if (\n          (!styleElement.textContent && styleElement.sheet?.cssRules?.length) ||\n          styleElement.hasAttribute('data-styled')\n        ) return\n        commonAction(styleElement, styleElement, styleElement.textContent!, prefix, app.url, styleElement.linkpath)\n      })\n\n      observer.observe(styleElement, { childList: true })\n    }\n  }\n\n  return styleElement\n}\n","import { isFunction } from '../libs/utils'\n\nfunction eventHandler (event: Event, element: HTMLLinkElement | HTMLScriptElement): void {\n  Object.defineProperties(event, {\n    currentTarget: {\n      get () {\n        return element\n      }\n    },\n    srcElement: {\n      get () {\n        return element\n      }\n    },\n    target: {\n      get () {\n        return element\n      }\n    },\n  })\n}\n\nexport function dispatchOnLoadEvent (element: HTMLLinkElement | HTMLScriptElement): void {\n  const event = new CustomEvent('load')\n  eventHandler(event, element)\n  if (isFunction(element.onload)) {\n    element.onload!(event)\n  } else {\n    element.dispatchEvent(event)\n  }\n}\n\nexport function dispatchOnErrorEvent (element: HTMLLinkElement | HTMLScriptElement): void {\n  const event = new CustomEvent('error')\n  eventHandler(event, element)\n  if (isFunction(element.onerror)) {\n    element.onerror!(event)\n  } else {\n    element.dispatchEvent(event)\n  }\n}\n","import type {\n  AppInterface,\n  sourceLinkInfo,\n} from '@micro-app/types'\nimport { fetchSource } from './fetch'\nimport {\n  CompletionPath,\n  promiseStream,\n  pureCreateElement,\n  defer,\n  logError,\n} from '../libs/utils'\nimport scopedCSS from './scoped_css'\nimport {\n  dispatchOnLoadEvent,\n  dispatchOnErrorEvent,\n} from './load_event'\n\n// Global links, reuse across apps\nexport const globalLinks = new Map<string, string>()\n\n/**\n * Extract link elements\n * @param link link element\n * @param parent parent element of link\n * @param app app\n * @param microAppHead micro-app-head element\n * @param isDynamic dynamic insert\n */\nexport function extractLinkFromHtml (\n  link: HTMLLinkElement,\n  parent: Node,\n  app: AppInterface,\n  microAppHead: Element | null,\n  isDynamic = false,\n): any {\n  const rel = link.getAttribute('rel')\n  let href = link.getAttribute('href')\n  let replaceComment: Comment | null = null\n  if (rel === 'stylesheet' && href) {\n    href = CompletionPath(href, app.url)\n    if (!isDynamic) {\n      replaceComment = document.createComment(`link element with href=${href} move to micro-app-head as style element`)\n      const placeholderComment = document.createComment(`placeholder for link with href=${href}`)\n      // all style elements insert into microAppHead\n      microAppHead!.appendChild(placeholderComment)\n      app.source.links.set(href, {\n        code: '',\n        placeholder: placeholderComment,\n        isGlobal: link.hasAttribute('global'),\n      })\n    } else {\n      return {\n        url: href,\n        info: {\n          code: '',\n          isGlobal: link.hasAttribute('global'),\n        }\n      }\n    }\n  } else if (rel && ['prefetch', 'preload', 'prerender', 'icon', 'apple-touch-icon'].includes(rel)) {\n    // preload prefetch  icon ....\n    if (isDynamic) {\n      replaceComment = document.createComment(`link element with rel=${rel}${href ? ' & href=' + href : ''} removed by micro-app`)\n    } else {\n      parent.removeChild(link)\n    }\n  } else if (href) {\n    // dns-prefetch preconnect modulepreload search ....\n    link.setAttribute('href', CompletionPath(href, app.url))\n  }\n\n  if (isDynamic) {\n    return { replaceComment }\n  } else if (replaceComment) {\n    return parent.replaceChild(replaceComment, link)\n  }\n}\n\n/**\n * Get link remote resources\n * @param wrapElement htmlDom\n * @param app app\n * @param microAppHead micro-app-head\n */\nexport function fetchLinksFromHtml (\n  wrapElement: HTMLElement,\n  app: AppInterface,\n  microAppHead: Element,\n): void {\n  const linkEntries: Array<[string, sourceLinkInfo]> = Array.from(app.source.links.entries())\n  const fetchLinkPromise: Array<Promise<string>|string> = []\n  for (const [url] of linkEntries) {\n    const globalLinkCode = globalLinks.get(url)\n    globalLinkCode ? fetchLinkPromise.push(globalLinkCode) : fetchLinkPromise.push(fetchSource(url, app.name))\n  }\n\n  promiseStream<string>(fetchLinkPromise, (res: {data: string, index: number}) => {\n    fetchLinkSuccess(\n      linkEntries[res.index][0],\n      linkEntries[res.index][1],\n      res.data,\n      microAppHead,\n      app,\n    )\n  }, (err: {error: Error, index: number}) => {\n    logError(err, app.name)\n  }, () => {\n    app.onLoad(wrapElement)\n  })\n}\n\n/**\n * fetch link succeeded, replace placeholder with style tag\n * @param url resource address\n * @param info resource link info\n * @param data code\n * @param microAppHead micro-app-head\n * @param app app\n */\nexport function fetchLinkSuccess (\n  url: string,\n  info: sourceLinkInfo,\n  data: string,\n  microAppHead: Element,\n  app: AppInterface,\n): void {\n  if (info.isGlobal && !globalLinks.has(url)) {\n    globalLinks.set(url, data)\n  }\n\n  const styleLink = pureCreateElement('style')\n  styleLink.textContent = data\n  styleLink.linkpath = url\n\n  microAppHead.replaceChild(scopedCSS(styleLink, app.name), info.placeholder!)\n\n  info.placeholder = null\n  info.code = data\n}\n\n/**\n * get css from dynamic link\n * @param url link address\n * @param info info\n * @param app app\n * @param originLink origin link element\n * @param replaceStyle style element which replaced origin link\n */\nexport function foramtDynamicLink (\n  url: string,\n  info: sourceLinkInfo,\n  app: AppInterface,\n  originLink: HTMLLinkElement,\n  replaceStyle: HTMLStyleElement,\n): void {\n  if (app.source.links.has(url)) {\n    replaceStyle.textContent = app.source.links.get(url)!.code\n    scopedCSS(replaceStyle, app.name)\n    defer(() => dispatchOnLoadEvent(originLink))\n    return\n  }\n\n  if (globalLinks.has(url)) {\n    const code = globalLinks.get(url)!\n    info.code = code\n    app.source.links.set(url, info)\n    replaceStyle.textContent = code\n    scopedCSS(replaceStyle, app.name)\n    defer(() => dispatchOnLoadEvent(originLink))\n    return\n  }\n\n  fetchSource(url, app.name).then((data: string) => {\n    info.code = data\n    app.source.links.set(url, info)\n    if (info.isGlobal) globalLinks.set(url, data)\n    replaceStyle.textContent = data\n    scopedCSS(replaceStyle, app.name)\n    dispatchOnLoadEvent(originLink)\n  }).catch((err) => {\n    logError(err, app.name)\n    dispatchOnErrorEvent(originLink)\n  })\n}\n","/* eslint-disable node/no-callback-literal */\nimport type {\n  AppInterface,\n  sourceScriptInfo,\n  plugins,\n  Func,\n} from '@micro-app/types'\nimport { fetchSource } from './fetch'\nimport {\n  CompletionPath,\n  promiseStream,\n  createNonceSrc,\n  pureCreateElement,\n  defer,\n  logError,\n  isUndefined,\n  isPlainObject,\n  isArray,\n  isFunction,\n} from '../libs/utils'\nimport {\n  dispatchOnLoadEvent,\n  dispatchOnErrorEvent,\n} from './load_event'\nimport microApp from '../micro_app'\nimport globalEnv from '../libs/global_env'\n\ntype moduleCallBack = Func & { moduleCount?: number }\n\n// Global scripts, reuse across apps\nexport const globalScripts = new Map<string, string>()\n\n/**\n * Extract script elements\n * @param script script element\n * @param parent parent element of script\n * @param app app\n * @param isDynamic dynamic insert\n */\nexport function extractScriptElement (\n  script: HTMLScriptElement,\n  parent: Node,\n  app: AppInterface,\n  isDynamic = false,\n): any {\n  let replaceComment: Comment | null = null\n  let src: string | null = script.getAttribute('src')\n  if (script.hasAttribute('exclude')) {\n    replaceComment = document.createComment('script element with exclude attribute removed by micro-app')\n  } else if (\n    (script.type && !['text/javascript', 'text/ecmascript', 'application/javascript', 'application/ecmascript', 'module'].includes(script.type)) ||\n    script.hasAttribute('ignore')\n  ) {\n    return null\n  } else if (\n    (globalEnv.supportModuleScript && script.noModule) ||\n    (!globalEnv.supportModuleScript && script.type === 'module')\n  ) {\n    replaceComment = document.createComment(`${script.noModule ? 'noModule' : 'module'} script ignored by micro-app`)\n  } else if (src) { // remote script\n    src = CompletionPath(src, app.url)\n    const info = {\n      code: '',\n      isExternal: true,\n      isDynamic: isDynamic,\n      async: script.hasAttribute('async'),\n      defer: script.defer || script.type === 'module',\n      module: script.type === 'module',\n      isGlobal: script.hasAttribute('global'),\n    }\n    if (!isDynamic) {\n      app.source.scripts.set(src, info)\n      replaceComment = document.createComment(`script with src='${src}' extract by micro-app`)\n    } else {\n      return { url: src, info }\n    }\n  } else if (script.textContent) { // inline script\n    const nonceStr: string = createNonceSrc()\n    const info = {\n      code: script.textContent,\n      isExternal: false,\n      isDynamic: isDynamic,\n      async: false,\n      defer: script.type === 'module',\n      module: script.type === 'module',\n    }\n    if (!isDynamic) {\n      app.source.scripts.set(nonceStr, info)\n      replaceComment = document.createComment('inline script extract by micro-app')\n    } else {\n      return { url: nonceStr, info }\n    }\n  } else {\n    replaceComment = document.createComment('script element removed by micro-app')\n  }\n\n  if (isDynamic) {\n    return { replaceComment }\n  } else {\n    return parent.replaceChild(replaceComment, script)\n  }\n}\n\n/**\n *  Get remote resources of script\n * @param wrapElement htmlDom\n * @param app app\n */\nexport function fetchScriptsFromHtml (\n  wrapElement: HTMLElement,\n  app: AppInterface,\n): void {\n  const scriptEntries: Array<[string, sourceScriptInfo]> = Array.from(app.source.scripts.entries())\n  const fetchScriptPromise: Promise<string>[] = []\n  const fetchScriptPromiseInfo: Array<[string, sourceScriptInfo]> = []\n  for (const [url, info] of scriptEntries) {\n    if (info.isExternal) {\n      const globalScriptText = globalScripts.get(url)\n      if (globalScriptText) {\n        info.code = globalScriptText\n      } else if (!info.defer && !info.async) {\n        fetchScriptPromise.push(fetchSource(url, app.name))\n        fetchScriptPromiseInfo.push([url, info])\n      }\n    }\n  }\n\n  if (fetchScriptPromise.length) {\n    promiseStream<string>(fetchScriptPromise, (res: {data: string, index: number}) => {\n      fetchScriptSuccess(\n        fetchScriptPromiseInfo[res.index][0],\n        fetchScriptPromiseInfo[res.index][1],\n        res.data,\n      )\n    }, (err: {error: Error, index: number}) => {\n      logError(err, app.name)\n    }, () => {\n      app.onLoad(wrapElement)\n    })\n  } else {\n    app.onLoad(wrapElement)\n  }\n}\n\n/**\n * fetch js succeeded, record the code value\n * @param url script address\n * @param info resource script info\n * @param data code\n */\nexport function fetchScriptSuccess (\n  url: string,\n  info: sourceScriptInfo,\n  data: string,\n): void {\n  if (info.isGlobal && !globalScripts.has(url)) {\n    globalScripts.set(url, data)\n  }\n\n  info.code = data\n}\n\n/**\n * Execute js in the mount lifecycle\n * @param scriptList script list\n * @param app app\n * @param initedHook callback for umd mode\n */\nexport function execScripts (\n  scriptList: Map<string, sourceScriptInfo>,\n  app: AppInterface,\n  initedHook: moduleCallBack,\n): void {\n  const scriptListEntries: Array<[string, sourceScriptInfo]> = Array.from(scriptList.entries())\n  const deferScriptPromise: Array<Promise<string>|string> = []\n  const deferScriptInfo: Array<[string, sourceScriptInfo]> = []\n  for (const [url, info] of scriptListEntries) {\n    if (!info.isDynamic) {\n      if (info.defer || info.async) {\n        if (info.isExternal && !info.code) {\n          deferScriptPromise.push(fetchSource(url, app.name))\n        } else {\n          deferScriptPromise.push(info.code)\n        }\n        deferScriptInfo.push([url, info])\n\n        if (info.module) initedHook.moduleCount = initedHook.moduleCount ? ++initedHook.moduleCount : 1\n      } else {\n        runScript(url, info.code, app, info.module, false)\n      }\n    }\n  }\n\n  if (deferScriptPromise.length) {\n    Promise.all(deferScriptPromise).then((res: string[]) => {\n      res.forEach((code, index) => {\n        const [url, info] = deferScriptInfo[index]\n        runScript(url, info.code = info.code || code, app, info.module, false, initedHook)\n      })\n      initedHook(isUndefined(initedHook.moduleCount))\n    }).catch((err) => {\n      logError(err, app.name)\n      initedHook(true)\n    })\n  } else {\n    initedHook(true)\n  }\n}\n\n/**\n * run code\n * @param url script address\n * @param code js code\n * @param app app\n * @param module type='module' of script\n * @param isDynamic dynamically created script\n * @param callback callback of module script\n */\nexport function runScript (\n  url: string,\n  code: string,\n  app: AppInterface,\n  module: boolean,\n  isDynamic: boolean,\n  callback?: moduleCallBack,\n): any {\n  try {\n    code = bindScope(url, code, app, module)\n    if (app.inline || module) {\n      const scriptElement = pureCreateElement('script')\n      setInlinScriptContent(url, code, module, scriptElement, callback)\n      if (isDynamic) return scriptElement\n      app.container?.querySelector('micro-app-body')!.appendChild(scriptElement)\n    } else {\n      Function(code)()\n      if (isDynamic) return document.createComment('dynamic script extract by micro-app')\n    }\n  } catch (e) {\n    console.error(`[micro-app from runScript] app ${app.name}: `, e)\n  }\n}\n\n/**\n * Get dynamically created remote script\n * @param url script address\n * @param info info\n * @param app app\n * @param originScript origin script element\n */\nexport function runDynamicRemoteScript (\n  url: string,\n  info: sourceScriptInfo,\n  app: AppInterface,\n  originScript: HTMLScriptElement,\n): HTMLScriptElement | Comment {\n  const dispatchScriptOnLoadEvent = () => dispatchOnLoadEvent(originScript)\n\n  if (app.source.scripts.has(url)) {\n    const existInfo: sourceScriptInfo = app.source.scripts.get(url)!\n    if (!info.module) defer(dispatchScriptOnLoadEvent)\n    return runScript(url, existInfo.code, app, info.module, true, dispatchScriptOnLoadEvent)\n  }\n\n  if (globalScripts.has(url)) {\n    const code = globalScripts.get(url)!\n    info.code = code\n    app.source.scripts.set(url, info)\n    if (!info.module) defer(dispatchScriptOnLoadEvent)\n    return runScript(url, code, app, info.module, true, dispatchScriptOnLoadEvent)\n  }\n\n  let replaceElement: Comment | HTMLScriptElement\n  if (app.inline || info.module) {\n    replaceElement = pureCreateElement('script')\n  } else {\n    replaceElement = document.createComment(`dynamic script with src='${url}' extract by micro-app`)\n  }\n\n  fetchSource(url, app.name).then((code: string) => {\n    info.code = code\n    app.source.scripts.set(url, info)\n    if (info.isGlobal) globalScripts.set(url, code)\n    try {\n      code = bindScope(url, code, app, info.module)\n      if (app.inline || info.module) {\n        setInlinScriptContent(url, code, info.module, replaceElement as HTMLScriptElement, dispatchScriptOnLoadEvent)\n      } else {\n        Function(code)()\n      }\n    } catch (e) {\n      console.error(`[micro-app from runDynamicScript] app ${app.name}: `, e, url)\n    }\n    if (!info.module) dispatchOnLoadEvent(originScript)\n  }).catch((err) => {\n    logError(err, app.name)\n    dispatchOnErrorEvent(originScript)\n  })\n\n  return replaceElement\n}\n\n/**\n * common handle for inline script\n * @param url script address\n * @param code js code\n * @param module type='module' of script\n * @param scriptElement target script element\n * @param callback callback of module script\n */\nfunction setInlinScriptContent (\n  url: string,\n  code: string,\n  module: boolean,\n  scriptElement: HTMLScriptElement,\n  callback?: moduleCallBack,\n): void {\n  if (module) {\n    // module script is async, transform it to a blob for subsequent operations\n    const blob = new Blob([code], { type: 'text/javascript;charset=utf-8' })\n    scriptElement.src = URL.createObjectURL(blob)\n    scriptElement.setAttribute('type', 'module')\n    if (!url.startsWith('inline-')) {\n      scriptElement.setAttribute('originSrc', url)\n    }\n    if (callback) {\n      callback.moduleCount && callback.moduleCount--\n      scriptElement.onload = callback.bind(scriptElement, callback.moduleCount === 0)\n    }\n  } else {\n    scriptElement.textContent = code\n  }\n}\n\n/**\n * bind js scope\n * @param url script address\n * @param code code\n * @param app app\n * @param module type='module' of script\n */\nfunction bindScope (\n  url: string,\n  code: string,\n  app: AppInterface,\n  module: boolean,\n): string {\n  if (isPlainObject(microApp.plugins)) {\n    code = usePlugins(url, code, app.name, microApp.plugins!)\n  }\n  if (app.sandBox && !module) {\n    globalEnv.rawWindow.__MICRO_APP_PROXY_WINDOW__ = app.sandBox.proxyWindow\n    return `;(function(window, self){with(window){;${code}\\n}}).call(window.__MICRO_APP_PROXY_WINDOW__, window.__MICRO_APP_PROXY_WINDOW__, window.__MICRO_APP_PROXY_WINDOW__);`\n  }\n  return code\n}\n\n/**\n * Call the plugin to process the file\n * @param url script address\n * @param code code\n * @param appName app name\n * @param plugins plugin list\n */\nfunction usePlugins (url: string, code: string, appName: string, plugins: plugins): string {\n  if (isArray(plugins.global)) {\n    for (const plugin of plugins.global) {\n      if (isPlainObject(plugin) && isFunction(plugin.loader)) {\n        code = plugin.loader!(code, url, plugin.options)\n      }\n    }\n  }\n\n  if (isArray(plugins.modules?.[appName])) {\n    for (const plugin of plugins.modules![appName]) {\n      if (isPlainObject(plugin) && isFunction(plugin.loader)) {\n        code = plugin.loader!(code, url, plugin.options)\n      }\n    }\n  }\n\n  return code\n}\n","import type { Func, AppInterface } from '@micro-app/types'\nimport { appInstanceMap } from '../create_app'\nimport {\n  CompletionPath,\n  getCurrentAppName,\n  pureCreateElement,\n  setCurrentAppName,\n  logWarn,\n  isPlainObject,\n  isString,\n} from '../libs/utils'\nimport scopedCSS from './scoped_css'\nimport { extractLinkFromHtml, foramtDynamicLink } from './links'\nimport { extractScriptElement, runScript, runDynamicRemoteScript } from './scripts'\nimport microApp from '../micro_app'\nimport globalEnv from '../libs/global_env'\n\n// Record element and map element\nconst dynamicElementInMicroAppMap = new WeakMap<Node, Element | Comment>()\n\n/**\n * Process the new node and format the style, link and script element\n * @param parent parent node\n * @param child new node\n * @param app app\n */\nfunction handleNewNode (parent: Node, child: Node, app: AppInterface): Node {\n  if (child instanceof HTMLStyleElement) {\n    if (child.hasAttribute('exclude')) {\n      const replaceComment = document.createComment('style element with exclude attribute ignored by micro-app')\n      dynamicElementInMicroAppMap.set(child, replaceComment)\n      return replaceComment\n    } else if (app.scopecss && !child.hasAttribute('ignore')) {\n      return scopedCSS(child, app.name)\n    }\n    return child\n  } else if (child instanceof HTMLLinkElement) {\n    if (child.hasAttribute('exclude')) {\n      const linkReplaceComment = document.createComment('link element with exclude attribute ignored by micro-app')\n      dynamicElementInMicroAppMap.set(child, linkReplaceComment)\n      return linkReplaceComment\n    } else if (!app.scopecss || child.hasAttribute('ignore')) {\n      return child\n    }\n\n    const { url, info, replaceComment } = extractLinkFromHtml(\n      child,\n      parent,\n      app,\n      null,\n      true,\n    )\n\n    if (url && info) {\n      const replaceStyle = pureCreateElement('style')\n      replaceStyle.linkpath = url\n      foramtDynamicLink(url, info, app, child, replaceStyle)\n      dynamicElementInMicroAppMap.set(child, replaceStyle)\n      return replaceStyle\n    } else if (replaceComment) {\n      dynamicElementInMicroAppMap.set(child, replaceComment)\n      return replaceComment\n    }\n\n    return child\n  } else if (child instanceof HTMLScriptElement) {\n    const { replaceComment, url, info } = extractScriptElement(\n      child,\n      parent,\n      app,\n      true,\n    ) || {}\n\n    if (url && info) {\n      if (info.code) { // inline script\n        const replaceElement = runScript(url, info.code, app, info.module, true)\n        dynamicElementInMicroAppMap.set(child, replaceElement)\n        return replaceElement\n      } else { // remote script\n        const replaceElement = runDynamicRemoteScript(url, info, app, child)\n        dynamicElementInMicroAppMap.set(child, replaceElement)\n        return replaceElement\n      }\n    } else if (replaceComment) {\n      dynamicElementInMicroAppMap.set(child, replaceComment)\n      return replaceComment\n    }\n\n    return child\n  }\n\n  return child\n}\n\n/**\n * Handle the elements inserted into head and body, and execute normally in other cases\n * @param app app\n * @param method raw method\n * @param parent parent node\n * @param targetChild target node\n * @param passiveChild second param of insertBefore and replaceChild\n */\nfunction invokePrototypeMethod (\n  app: AppInterface,\n  rawMethod: Func,\n  parent: Node,\n  targetChild: Node,\n  passiveChild?: Node | null,\n): any {\n  /**\n   * If passiveChild is not the child node, insertBefore replaceChild will have a problem, at this time, it will be degraded to appendChild\n   * E.g: document.head.insertBefore(targetChild, document.head.childNodes[0])\n   */\n  if (parent === document.head) {\n    const microAppHead = app.container!.querySelector('micro-app-head')!\n    /**\n     * 1. If passivechild exists, it must be insertBefore or replacechild\n     * 2. When removeChild, targetChild may not be in microAppHead or head\n     */\n    if (passiveChild && !microAppHead.contains(passiveChild)) {\n      return globalEnv.rawAppendChild.call(microAppHead, targetChild)\n    } else if (rawMethod === globalEnv.rawRemoveChild && !microAppHead.contains(targetChild)) {\n      if (parent.contains(targetChild)) {\n        return rawMethod.call(parent, targetChild)\n      }\n      return targetChild\n    } else if (rawMethod === globalEnv.rawAppend || rawMethod === globalEnv.rawPrepend) {\n      return rawMethod.call(microAppHead, targetChild)\n    }\n    return rawMethod.call(microAppHead, targetChild, passiveChild)\n  } else if (parent === document.body) {\n    const microAppBody = app.container!.querySelector('micro-app-body')!\n    if (passiveChild && !microAppBody.contains(passiveChild)) {\n      return globalEnv.rawAppendChild.call(microAppBody, targetChild)\n    } else if (rawMethod === globalEnv.rawRemoveChild && !microAppBody.contains(targetChild)) {\n      if (parent.contains(targetChild)) {\n        return rawMethod.call(parent, targetChild)\n      }\n      return targetChild\n    } else if (rawMethod === globalEnv.rawAppend || rawMethod === globalEnv.rawPrepend) {\n      return rawMethod.call(microAppBody, targetChild)\n    }\n    return rawMethod.call(microAppBody, targetChild, passiveChild)\n  } else if (rawMethod === globalEnv.rawAppend || rawMethod === globalEnv.rawPrepend) {\n    return rawMethod.call(parent, targetChild)\n  }\n\n  return rawMethod.call(parent, targetChild, passiveChild)\n}\n\n// Get the map element\nfunction getMappingNode (node: Node): Node {\n  return dynamicElementInMicroAppMap.get(node) ?? node\n}\n\n/**\n * method of handle new node\n * @param parent parent node\n * @param newChild new node\n * @param passiveChild passive node\n * @param rawMethodraw method\n */\nfunction commonElementHander (\n  parent: Node,\n  newChild: Node,\n  passiveChild: Node | null,\n  rawMethod: Func,\n) {\n  if (newChild?.__MICRO_APP_NAME__) {\n    const app = appInstanceMap.get(newChild.__MICRO_APP_NAME__)\n    if (app?.container) {\n      return invokePrototypeMethod(\n        app,\n        rawMethod,\n        parent,\n        handleNewNode(parent, newChild, app),\n        passiveChild && getMappingNode(passiveChild),\n      )\n    } else if (rawMethod === globalEnv.rawAppend || rawMethod === globalEnv.rawPrepend) {\n      return rawMethod.call(parent, newChild)\n    }\n    return rawMethod.call(parent, newChild, passiveChild)\n  } else if (rawMethod === globalEnv.rawAppend || rawMethod === globalEnv.rawPrepend) {\n    const appName = getCurrentAppName()\n    if (!(newChild instanceof Node) && appName) {\n      const app = appInstanceMap.get(appName)\n      if (app?.container) {\n        if (parent === document.head) {\n          return rawMethod.call(app.container.querySelector('micro-app-head'), newChild)\n        } else if (parent === document.body) {\n          return rawMethod.call(app.container.querySelector('micro-app-body'), newChild)\n        }\n      }\n    }\n    return rawMethod.call(parent, newChild)\n  }\n\n  return rawMethod.call(parent, newChild, passiveChild)\n}\n\n/**\n * Rewrite element prototype method\n */\nexport function patchElementPrototypeMethods (): void {\n  patchDocument()\n\n  // Rewrite setAttribute\n  Element.prototype.setAttribute = function setAttribute (key: string, value: string): void {\n    if (/^micro-app(-\\S+)?/i.test(this.tagName) && key === 'data') {\n      if (isPlainObject(value)) {\n        const cloneValue: Record<PropertyKey, unknown> = {}\n        Object.getOwnPropertyNames(value).forEach((propertyKey: PropertyKey) => {\n          if (!(isString(propertyKey) && propertyKey.indexOf('__') === 0)) {\n            // @ts-ignore\n            cloneValue[propertyKey] = value[propertyKey]\n          }\n        })\n        this.data = cloneValue\n      } else if (value !== '[object Object]') {\n        logWarn('property data must be an object', this.getAttribute('name'))\n      }\n    } else if (\n      (\n        (key === 'src' && /^(img|script)$/i.test(this.tagName)) ||\n        (key === 'href' && /^link$/i.test(this.tagName))\n      ) &&\n      this.__MICRO_APP_NAME__ &&\n      appInstanceMap.has(this.__MICRO_APP_NAME__)\n    ) {\n      const app = appInstanceMap.get(this.__MICRO_APP_NAME__)\n      globalEnv.rawSetAttribute.call(this, key, CompletionPath(value, app!.url))\n    } else {\n      globalEnv.rawSetAttribute.call(this, key, value)\n    }\n  }\n\n  // prototype methods of add elementðŸ‘‡\n  Node.prototype.appendChild = function appendChild<T extends Node> (newChild: T): T {\n    return commonElementHander(this, newChild, null, globalEnv.rawAppendChild)\n  }\n\n  Node.prototype.insertBefore = function insertBefore<T extends Node> (newChild: T, refChild: Node | null): T {\n    return commonElementHander(this, newChild, refChild, globalEnv.rawInsertBefore)\n  }\n\n  Node.prototype.replaceChild = function replaceChild<T extends Node> (newChild: Node, oldChild: T): T {\n    return commonElementHander(this, newChild, oldChild, globalEnv.rawReplaceChild)\n  }\n\n  Element.prototype.append = function append (...nodes: (Node | string)[]): void {\n    let i = 0\n    const length = nodes.length\n    while (i < length) {\n      commonElementHander(this, nodes[i] as Node, null, globalEnv.rawAppend)\n      i++\n    }\n  }\n\n  Element.prototype.prepend = function prepend (...nodes: (Node | string)[]): void {\n    let i = nodes.length\n    while (i > 0) {\n      commonElementHander(this, nodes[i - 1] as Node, null, globalEnv.rawPrepend)\n      i--\n    }\n  }\n\n  // prototype methods of delete elementðŸ‘‡\n  Node.prototype.removeChild = function removeChild<T extends Node> (oldChild: T): T {\n    if (oldChild?.__MICRO_APP_NAME__) {\n      const app = appInstanceMap.get(oldChild.__MICRO_APP_NAME__)\n      if (app?.container) {\n        return invokePrototypeMethod(\n          app,\n          globalEnv.rawRemoveChild,\n          this,\n          getMappingNode(oldChild),\n        )\n      }\n      return globalEnv.rawRemoveChild.call(this, oldChild) as T\n    }\n\n    return globalEnv.rawRemoveChild.call(this, oldChild) as T\n  }\n}\n\n/**\n * Mark the newly created element in the micro application\n * @param element new element\n */\nfunction markElement <T extends { __MICRO_APP_NAME__: string }> (element: T): T {\n  const appName = getCurrentAppName()\n  if (appName) {\n    element.__MICRO_APP_NAME__ = appName\n  }\n  return element\n}\n\n// methods of document\nfunction patchDocument () {\n  const rawDocument = globalEnv.rawDocument\n\n  // create element ðŸ‘‡\n  Document.prototype.createElement = function createElement (\n    tagName: string,\n    options?: ElementCreationOptions,\n  ): HTMLElement {\n    const element = globalEnv.rawCreateElement.call(rawDocument, tagName, options)\n    return markElement(element)\n  }\n\n  Document.prototype.createElementNS = function createElementNS (\n    namespaceURI: string,\n    name: string,\n    options?: string | ElementCreationOptions,\n  ): any {\n    const element = globalEnv.rawCreateElementNS.call(rawDocument, namespaceURI, name, options)\n    return markElement(element)\n  }\n\n  Document.prototype.createDocumentFragment = function createDocumentFragment (): DocumentFragment {\n    const element = globalEnv.rawCreateDocumentFragment.call(rawDocument)\n    return markElement(element)\n  }\n\n  // query elementðŸ‘‡\n  function querySelector (selectors: string): any {\n    const appName = getCurrentAppName()\n    if (!appName || selectors === 'head' || selectors === 'body' || selectors === 'html') {\n      return globalEnv.rawQuerySelector.call(rawDocument, selectors)\n    }\n    return appInstanceMap.get(appName)?.container?.querySelector(selectors) ?? null\n  }\n\n  function querySelectorAll (selectors: string): any {\n    const appName = getCurrentAppName()\n    if (!appName || selectors === 'head' || selectors === 'body' || selectors === 'html') {\n      return globalEnv.rawQuerySelectorAll.call(rawDocument, selectors)\n    }\n    return appInstanceMap.get(appName)?.container?.querySelectorAll(selectors) ?? []\n  }\n\n  Document.prototype.querySelector = querySelector\n  Document.prototype.querySelectorAll = querySelectorAll\n\n  // querySelector does not support the beginning of a number\n  Document.prototype.getElementById = function getElementById (key: string): HTMLElement | null {\n    const appName = getCurrentAppName()\n    if (!appName || /^\\d/.test(key)) {\n      return globalEnv.rawGetElementById.call(rawDocument, key)\n    }\n    return querySelector(`#${key}`)\n  }\n\n  Document.prototype.getElementsByClassName = function getElementsByClassName (key: string): HTMLCollectionOf<Element> {\n    const appName = getCurrentAppName()\n    if (!appName || /^\\d/.test(key)) {\n      return globalEnv.rawGetElementsByClassName.call(rawDocument, key)\n    }\n    return querySelectorAll(`.${key}`)\n  }\n\n  Document.prototype.getElementsByTagName = function getElementsByTagName (key: string): HTMLCollectionOf<Element> {\n    const appName = getCurrentAppName()\n    if (\n      !appName ||\n      /^body$/i.test(key) ||\n      /^head$/i.test(key) ||\n      /^html$/i.test(key) ||\n      (!appInstanceMap.get(appName)?.inline && /^script$/i.test(key))\n    ) {\n      return globalEnv.rawGetElementsByTagName.call(rawDocument, key)\n    }\n    return querySelectorAll(key)\n  }\n\n  Document.prototype.getElementsByName = function getElementsByName (key: string): NodeListOf<HTMLElement> {\n    const appName = getCurrentAppName()\n    if (!appName || /^\\d/.test(key)) {\n      return globalEnv.rawGetElementsByName.call(rawDocument, key)\n    }\n    return querySelectorAll(`[name=${key}]`)\n  }\n}\n\nfunction releasePatchDocument (): void {\n  Document.prototype.createElement = globalEnv.rawCreateElement\n  Document.prototype.createElementNS = globalEnv.rawCreateElementNS\n  Document.prototype.createDocumentFragment = globalEnv.rawCreateDocumentFragment\n  Document.prototype.querySelector = globalEnv.rawQuerySelector\n  Document.prototype.querySelectorAll = globalEnv.rawQuerySelectorAll\n  Document.prototype.getElementById = globalEnv.rawGetElementById\n  Document.prototype.getElementsByClassName = globalEnv.rawGetElementsByClassName\n  Document.prototype.getElementsByTagName = globalEnv.rawGetElementsByTagName\n  Document.prototype.getElementsByName = globalEnv.rawGetElementsByName\n}\n\n// release patch\nexport function releasePatches (): void {\n  setCurrentAppName(null)\n  releasePatchDocument()\n  Element.prototype.setAttribute = globalEnv.rawSetAttribute\n  Node.prototype.appendChild = globalEnv.rawAppendChild\n  Node.prototype.insertBefore = globalEnv.rawInsertBefore\n  Node.prototype.replaceChild = globalEnv.rawReplaceChild\n  Node.prototype.removeChild = globalEnv.rawRemoveChild\n  Element.prototype.append = globalEnv.rawAppend\n  Element.prototype.prepend = globalEnv.rawPrepend\n}\n\n// Set the style of micro-app-head and micro-app-body\nlet hasRejectMicroAppStyle = false\nexport function rejectMicroAppStyle (): void {\n  if (!hasRejectMicroAppStyle) {\n    hasRejectMicroAppStyle = true\n    const style = pureCreateElement('style')\n    style.setAttribute('type', 'text/css')\n    style.textContent = `\\n${microApp.tagName}, micro-app-body { display: block; } \\nmicro-app-head { display: none; }`\n    globalEnv.rawDocument.head.appendChild(style)\n  }\n}\n","import { appInstanceMap } from '../create_app'\nimport { elementInstanceMap } from '../micro_app_element'\nimport { releasePatches } from '../source/patch'\n\nfunction unmountNestedApp (): void {\n  replaseUnmountOfNestedApp()\n\n  appInstanceMap.forEach(app => {\n    let element = app.container\n    if (element) {\n      if (element instanceof ShadowRoot) {\n        element = element.host as HTMLElement\n      }\n      // @ts-ignore\n      element.disconnectedCallback()\n    }\n  })\n\n  if (!window.__MICRO_APP_UMD_MODE__) appInstanceMap.clear()\n\n  if (elementInstanceMap.size) {\n    elementInstanceMap.clear()\n    releasePatches()\n  }\n}\n\n// if micro-app run in micro application, delete all next generation application when unmount event received\nexport function listenUmountOfNestedApp (): void {\n  if (window.__MICRO_APP_ENVIRONMENT__) {\n    window.addEventListener('unmount', unmountNestedApp, false)\n  }\n}\n\n// release listener\nexport function replaseUnmountOfNestedApp (): void {\n  if (window.__MICRO_APP_ENVIRONMENT__) {\n    window.removeEventListener('unmount', unmountNestedApp, false)\n  }\n}\n","import microApp from '../micro_app'\nimport { logError, isFunction } from '../libs/utils'\n\nfunction eventHandler (event: CustomEvent, element: HTMLElement): void {\n  Object.defineProperties(event, {\n    currentTarget: {\n      get () {\n        return element\n      }\n    },\n    target: {\n      get () {\n        return element\n      }\n    },\n  })\n}\n\n/**\n * dispatch lifeCycles event\n * @param element container\n * @param appName app.name\n * @param lifecycleName lifeCycle name\n * @param error param from error hook\n */\nexport default function dispatchLifecyclesEvent (\n  element: HTMLElement,\n  appName: string,\n  lifecycleName: string,\n  error?: Error,\n): void {\n  if (!element) {\n    return logError(`element does not exist in lifecycle ${lifecycleName}ï¼Œit seems the app has unmounted`, appName)\n  } else if (element instanceof ShadowRoot) {\n    element = element.host as HTMLElement\n  }\n\n  const detail = Object.assign({\n    name: appName,\n    container: element,\n  }, error && {\n    error\n  })\n\n  const event = new CustomEvent(lifecycleName, {\n    detail,\n  })\n\n  eventHandler(event, element)\n  // global hooks\n  // @ts-ignore\n  if (isFunction(microApp.lifeCycles?.[lifecycleName])) {\n    // @ts-ignore\n    microApp.lifeCycles[lifecycleName](event)\n  }\n\n  element.dispatchEvent(event)\n}\n\n/**\n * Dispatch unmount event to micro app\n * @param appName app.name\n */\nexport function dispatchUnmountToMicroApp (appName: string): void {\n  const event = new CustomEvent(`unmount-${appName}`)\n  window.dispatchEvent(event)\n}\n","import type { AttrType, MicroAppElementType, AppInterface } from '@micro-app/types'\nimport { defer, formatURL, version, logError, isString } from './libs/utils'\nimport { ObservedAttrName, appStatus, lifeCycles } from './constants'\nimport CreateApp, { appInstanceMap } from './create_app'\nimport {\n  patchElementPrototypeMethods,\n  releasePatches,\n  rejectMicroAppStyle,\n} from './source/patch'\nimport {\n  listenUmountOfNestedApp,\n  replaseUnmountOfNestedApp,\n} from './libs/additional'\nimport microApp from './micro_app'\nimport dispatchLifecyclesEvent from './interact/lifecycles_event'\n\n// record all micro-app elements\nexport const elementInstanceMap = new Map<Element, boolean>()\n\n/**\n * define element\n * @param tagName element name\n */\nexport function defineElement (tagName: string): void {\n  class MicroAppElement extends HTMLElement implements MicroAppElementType {\n    static get observedAttributes (): string[] {\n      return ['name', 'url']\n    }\n\n    constructor () {\n      super()\n      // cloned node of umd container also trigger constructor, we should skip\n      if (!this.querySelector('micro-app-head')) {\n        this.performWhenFirstCreated()\n      }\n    }\n\n    appName = ''\n    appUrl = ''\n    version = version\n    isWating = false\n    cacheData: Record<PropertyKey, unknown> | null = null\n    hasConnected = false\n\n    // ðŸ‘‡ Configuration\n    // shadowDom: use shadowDOM, default is false\n    // destory: whether delete cache resources when unmount, default is false\n    // inline: whether js runs in inline script mode, default is false\n    // disableScopecss: whether disable css scoped, default is false\n    // disableSandbox: whether disable sandbox, default is false\n    // macro: used to solve the async render problem of vue3, default is false\n    // baseRoute: route prefix, default is ''\n\n    connectedCallback (): void {\n      this.hasConnected = true\n      if (!elementInstanceMap.has(this)) {\n        this.performWhenFirstCreated()\n      }\n\n      defer(() => dispatchLifecyclesEvent(\n        this,\n        this.appName,\n        lifeCycles.CREATED,\n      ))\n\n      this.initialMount()\n    }\n\n    disconnectedCallback (): void {\n      this.hasConnected = false\n      elementInstanceMap.delete(this)\n      this.handleUnmount(this.getDisposeResult('destory'))\n      if (elementInstanceMap.size === 0) {\n        releasePatches()\n      }\n    }\n\n    attributeChangedCallback (attr: ObservedAttrName, _oldVal: string, newVal: string): void {\n      if (\n        this.legalAttribute(attr, newVal) &&\n        this[attr === ObservedAttrName.NAME ? 'appName' : 'appUrl'] !== newVal\n      ) {\n        if (attr === ObservedAttrName.URL && !this.appUrl) {\n          newVal = formatURL(newVal, this.appName)\n          if (!newVal) {\n            return logError('Invalid attribute url', this.appName)\n          }\n          this.appUrl = newVal\n          this.handleInitialNameAndUrl()\n        } else if (attr === ObservedAttrName.NAME && !this.appName) {\n          if (this.cacheData) {\n            microApp.setData(newVal, this.cacheData)\n            this.cacheData = null\n          }\n          this.appName = newVal\n          this.handleInitialNameAndUrl()\n        } else if (!this.isWating) {\n          this.isWating = true\n          defer(this.handleAttributeUpdate)\n        }\n      }\n    }\n\n    // handle for connectedCallback run before attributeChangedCallback\n    handleInitialNameAndUrl (): void {\n      if (this.hasConnected) {\n        this.initialMount()\n      }\n    }\n\n    // Perform global initialization when the element count is 1\n    performWhenFirstCreated (): void {\n      if (elementInstanceMap.set(this, true).size === 1) {\n        patchElementPrototypeMethods()\n        rejectMicroAppStyle()\n        replaseUnmountOfNestedApp()\n        listenUmountOfNestedApp()\n      }\n    }\n\n    /**\n     * first mount of this app\n     */\n    initialMount (): void {\n      if (!this.appName || !this.appUrl) return\n\n      if (this.getDisposeResult('shadowDOM') && !this.shadowRoot) {\n        this.attachShadow({ mode: 'open' })\n      }\n\n      const app = appInstanceMap.get(this.appName)\n      if (app) {\n        if (\n          app.url === this.appUrl && (\n            app.isPrefetch ||\n            app.getAppStatus() === appStatus.UNMOUNT\n          )\n        ) {\n          this.handleAppMount(app)\n        } else if (app.isPrefetch) {\n          logError(`the url ${this.appUrl} is different from prefetch url ${app.url}`, this.appName)\n        } else {\n          logError(`an app named ${this.appName} already exists`, this.appName)\n        }\n      } else {\n        this.handleCreate()\n      }\n    }\n\n    /**\n     * handle for change of name an url after element inited\n     */\n    handleAttributeUpdate = (): void => {\n      this.isWating = false\n      const attrName = this.getAttribute('name')\n      const attrUrl = formatURL(this.getAttribute('url'), this.appName)\n      if (this.legalAttribute('name', attrName) && this.legalAttribute('url', attrUrl)) {\n        const existApp = appInstanceMap.get(attrName!)\n        if (attrName !== this.appName && existApp) {\n          // handling of cached and non-prefetch apps\n          if (appStatus.UNMOUNT !== existApp.getAppStatus() && !existApp.isPrefetch) {\n            this.setAttribute('name', this.appName)\n            return logError(`an app named ${attrName} already exists`, this.appName)\n          }\n        }\n\n        if (attrName !== this.appName || attrUrl !== this.appUrl) {\n          this.handleUnmount(attrName === this.appName)\n          this.appName = attrName as string\n          this.appUrl = attrUrl\n          ;(this.shadowRoot ?? this).innerHTML = ''\n          /**\n           * when existApp not undefined\n           * if attrName and this.appName are equal, existApp has been unmounted\n           * if attrName and this.appName are not equal, existApp is prefetch or unmounted\n           */\n          if (existApp && existApp.url === attrUrl) {\n            // mount app\n            this.handleAppMount(existApp)\n          } else {\n            this.handleCreate()\n          }\n        }\n      } else if (attrName !== this.appName) {\n        this.setAttribute('name', this.appName)\n      }\n    }\n\n    /**\n     * judge the attribute is legal\n     * @param name attribute name\n     * @param val attribute value\n     */\n    legalAttribute (name: string, val: AttrType): boolean {\n      if (!isString(val) || !val) {\n        logError(`unexpected attribute ${name}, please check again`, this.appName)\n\n        return false\n      }\n\n      return true\n    }\n\n    /**\n     * mount app\n     * some serious note before mount:\n     * 1. is prefetch ?\n     * 2. is remount in another container ?\n     * 3. is remount with change properties of the container ?\n     */\n    handleAppMount (app: AppInterface): void {\n      app.isPrefetch = false\n      defer(() => app.mount(\n        this.shadowRoot ?? this,\n        this.getDisposeResult('inline'),\n        this.getBaseRouteCompatible(),\n      ))\n    }\n\n    // create app instance\n    handleCreate (): void {\n      const instance: AppInterface = new CreateApp({\n        name: this.appName!,\n        url: this.appUrl!,\n        container: this.shadowRoot ?? this,\n        inline: this.getDisposeResult('inline'),\n        scopecss: !(this.getDisposeResult('disableScopecss') || this.getDisposeResult('shadowDOM')),\n        useSandbox: !this.getDisposeResult('disableSandbox'),\n        macro: this.getDisposeResult('macro'),\n        baseroute: this.getBaseRouteCompatible(),\n      })\n\n      appInstanceMap.set(this.appName!, instance)\n    }\n\n    /**\n     * unmount app\n     * @param destory delete cache resources when unmount\n     */\n    handleUnmount (destory: boolean): void {\n      const app = appInstanceMap.get(this.appName!)\n      if (app && appStatus.UNMOUNT !== app.getAppStatus()) app.unmount(destory)\n    }\n\n    /**\n     * Get configuration\n     * Global setting is lowest priority\n     * @param name Configuration item name\n     */\n    getDisposeResult (name: string): boolean {\n      // @ts-ignore\n      return (this.hasAttribute(name) || microApp[name]) && this.getAttribute(name) !== 'false'\n    }\n\n    /**\n     * 2021-09-08\n     * get baseRoute\n     * getAttribute('baseurl') is compatible writing of versions below 0.3.1\n     */\n    getBaseRouteCompatible (): string {\n      return this.getAttribute('baseroute') ?? this.getAttribute('baseurl') ?? ''\n    }\n\n    /**\n     * Data from the base application\n     */\n    set data (value: Record<PropertyKey, unknown> | null) {\n      if (this.appName) {\n        microApp.setData(this.appName, value!)\n      } else {\n        this.cacheData = value\n      }\n    }\n\n    /**\n     * get data only used in jsx-custom-event once\n     */\n    get data (): Record<PropertyKey, unknown> | null {\n      if (this.appName) {\n        return microApp.getData(this.appName, true)\n      } else if (this.cacheData) {\n        return this.cacheData\n      }\n      return null\n    }\n  }\n\n  window.customElements.define(tagName, MicroAppElement)\n}\n","import { CallableFunctionForInteract } from '@micro-app/types'\nimport { logError, isFunction, isPlainObject } from '../libs/utils'\n\nexport default class EventCenter {\n  eventList = new Map<string, {\n    data: Record<PropertyKey, unknown>,\n    callbacks: Set<CallableFunctionForInteract>,\n  }>()\n\n  // whether the name is legal\n  isLegalName (name: string): boolean {\n    if (!name) {\n      logError('event-center: Invalid name')\n      return false\n    }\n\n    return true\n  }\n\n  /**\n   * add listener\n   * @param name event name\n   * @param f listener\n   * @param autoTrigger If there is cached data when first bind listener, whether it needs to trigger, default is false\n   */\n  on (name: string, f: CallableFunctionForInteract, autoTrigger = false): void {\n    if (this.isLegalName(name)) {\n      if (!isFunction(f)) {\n        return logError('event-center: Invalid callback function')\n      }\n\n      let eventInfo = this.eventList.get(name)\n      if (!eventInfo) {\n        eventInfo = {\n          data: {},\n          callbacks: new Set(),\n        }\n        this.eventList.set(name, eventInfo)\n      } else if (autoTrigger && Object.getOwnPropertyNames(eventInfo.data).length) {\n        // auto trigger when data not null\n        f(eventInfo.data)\n      }\n\n      eventInfo.callbacks.add(f)\n    }\n  }\n\n  // remove listener, but the data is not cleared\n  off (name: string, f?: CallableFunctionForInteract): void {\n    if (this.isLegalName(name)) {\n      const eventInfo = this.eventList.get(name)\n      if (eventInfo) {\n        if (isFunction(f)) {\n          eventInfo.callbacks.delete(f!)\n        } else {\n          eventInfo.callbacks.clear()\n        }\n      }\n    }\n  }\n\n  // dispatch data\n  dispatch (name: string, data: Record<PropertyKey, unknown>): void {\n    if (this.isLegalName(name)) {\n      if (!isPlainObject(data)) {\n        return logError('event-center: data must be object')\n      }\n      let eventInfo = this.eventList.get(name)\n      if (eventInfo) {\n        // Update when the data is not equal\n        if (eventInfo.data !== data) {\n          eventInfo.data = data\n          for (const f of eventInfo.callbacks) {\n            f(data)\n          }\n        }\n      } else {\n        eventInfo = {\n          data: data,\n          callbacks: new Set(),\n        }\n        this.eventList.set(name, eventInfo)\n      }\n    }\n  }\n\n  // get data\n  getData (name: string): Record<PropertyKey, unknown> | null {\n    const eventInfo = this.eventList.get(name)\n    return eventInfo?.data ?? null\n  }\n}\n","import { CallableFunctionForInteract } from '@micro-app/types'\nimport EventCenter from './event_center'\nimport { appInstanceMap } from '../create_app'\nimport { removeDomScope, isString, isFunction, isPlainObject } from '../libs/utils'\n\nconst eventCenter = new EventCenter()\n\n/**\n * Format event name\n * @param appName app.name\n * @param fromBaseApp is from base app\n */\nfunction formatEventName (appName: string, fromBaseApp: boolean): string {\n  if (!isString(appName) || !appName) return ''\n  return fromBaseApp ? `__from_base_app_${appName}__` : `__from_micro_app_${appName}__`\n}\n\n// Global data\nclass EventCenterForGlobal {\n  /**\n   * add listener of global data\n   * @param cb listener\n   * @param autoTrigger If there is cached data when first bind listener, whether it needs to trigger, default is false\n   */\n  addGlobalDataListener (cb: CallableFunctionForInteract, autoTrigger?: boolean): void {\n    const appName = (this as any).appName\n    // if appName exists, this is in sub app\n    if (appName) {\n      cb.__APP_NAME__ = appName\n      cb.__AUTO_TRIGGER__ = autoTrigger\n    }\n    eventCenter.on('global', cb, autoTrigger)\n  }\n\n  /**\n   * remove listener of global data\n   * @param cb listener\n   */\n  removeGlobalDataListener (cb: CallableFunctionForInteract): void {\n    if (isFunction(cb)) {\n      eventCenter.off('global', cb)\n    }\n  }\n\n  /**\n   * dispatch global data\n   * @param data data\n   */\n  setGlobalData (data: Record<PropertyKey, unknown>): void {\n    eventCenter.dispatch('global', data)\n  }\n\n  /**\n   * clear all listener of global data\n   * if appName exists, only the specified functions is cleared\n   * if appName not exists, only clear the base app functions\n   */\n  clearGlobalDataListener (): void {\n    const appName = (this as any).appName\n    const eventInfo = eventCenter.eventList.get('global')\n    if (eventInfo) {\n      for (const cb of eventInfo.callbacks) {\n        if (\n          (appName && appName === cb.__APP_NAME__) ||\n          !(appName || cb.__APP_NAME__)\n        ) {\n          eventInfo.callbacks.delete(cb)\n        }\n      }\n    }\n  }\n}\n\n// Event center for base app\nexport class EventCenterForBaseApp extends EventCenterForGlobal {\n  /**\n   * add listener\n   * @param appName app.name\n   * @param cb listener\n   * @param autoTrigger If there is cached data when first bind listener, whether it needs to trigger, default is false\n   */\n  addDataListener (appName: string, cb: CallableFunction, autoTrigger?: boolean): void {\n    eventCenter.on(formatEventName(appName, false), cb, autoTrigger)\n  }\n\n  /**\n   * remove listener\n   * @param appName app.name\n   * @param cb listener\n   */\n  removeDataListener (appName: string, cb: CallableFunction): void {\n    if (isFunction(cb)) {\n      eventCenter.off(formatEventName(appName, false), cb)\n    }\n  }\n\n  /**\n   * get data from micro app or base app\n   * @param appName app.name\n   * @param fromBaseApp whether get data from base app, default is false\n   */\n  getData (appName: string, fromBaseApp = false): Record<PropertyKey, unknown> | null {\n    return eventCenter.getData(formatEventName(appName, fromBaseApp))\n  }\n\n  /**\n   * Dispatch data to the specified micro app\n   * @param appName app.name\n   * @param data data\n   */\n  setData (appName: string, data: Record<PropertyKey, unknown>): void {\n    eventCenter.dispatch(formatEventName(appName, true), data)\n  }\n\n  /**\n   * clear all listener for specified micro app\n   * @param appName app.name\n   */\n  clearDataListener (appName: string): void {\n    eventCenter.off(formatEventName(appName, false))\n  }\n}\n\n// Event center for sub app\nexport class EventCenterForMicroApp extends EventCenterForGlobal {\n  appName: string\n  umdDataListeners?: {\n    global: Set<CallableFunctionForInteract>,\n    normal: Set<CallableFunctionForInteract>,\n  }\n\n  constructor (appName: string) {\n    super()\n    this.appName = appName\n  }\n\n  /**\n   * add listener, monitor the data sent by the base app\n   * @param cb listener\n   * @param autoTrigger If there is cached data when first bind listener, whether it needs to trigger, default is false\n   */\n  addDataListener (cb: CallableFunctionForInteract, autoTrigger?: boolean): void {\n    cb.__AUTO_TRIGGER__ = autoTrigger\n    eventCenter.on(formatEventName(this.appName, true), cb, autoTrigger)\n  }\n\n  /**\n   * remove listener\n   * @param cb listener\n   */\n  removeDataListener (cb: CallableFunctionForInteract): void {\n    if (isFunction(cb)) {\n      eventCenter.off(formatEventName(this.appName, true), cb)\n    }\n  }\n\n  /**\n   * get data from base app\n   */\n  getData (): Record<PropertyKey, unknown> | null {\n    return eventCenter.getData(formatEventName(this.appName, true))\n  }\n\n  /**\n   * dispatch data to base app\n   * @param data data\n   */\n  dispatch (data: Record<PropertyKey, unknown>): void {\n    removeDomScope()\n\n    eventCenter.dispatch(formatEventName(this.appName, false), data)\n\n    const app = appInstanceMap.get(this.appName)\n    if (app?.container && isPlainObject(data)) {\n      const event = new CustomEvent('datachange', {\n        detail: {\n          data,\n        }\n      })\n\n      let element = app.container\n      if (element instanceof ShadowRoot) {\n        element = element.host as HTMLElement\n      }\n      element.dispatchEvent(event)\n    }\n  }\n\n  /**\n   * clear all listeners\n   */\n  clearDataListener (): void {\n    eventCenter.off(formatEventName(this.appName, true))\n  }\n}\n\n/**\n * Record UMD function before exec umdHookMount\n * @param microAppEventCneter\n */\nexport function recordDataCenterSnapshot (microAppEventCneter: EventCenterForMicroApp): void {\n  const appName = microAppEventCneter.appName\n  microAppEventCneter.umdDataListeners = { global: new Set(), normal: new Set() }\n\n  const globalEventInfo = eventCenter.eventList.get('global')\n  if (globalEventInfo) {\n    for (const cb of globalEventInfo.callbacks) {\n      if (appName === cb.__APP_NAME__) {\n        microAppEventCneter.umdDataListeners.global.add(cb)\n      }\n    }\n  }\n\n  const subAppEventInfo = eventCenter.eventList.get(formatEventName(appName, true))\n  if (subAppEventInfo) {\n    microAppEventCneter.umdDataListeners.normal = new Set(subAppEventInfo.callbacks)\n  }\n}\n\n/**\n * Rebind the UMD function of the record before remount\n * @param microAppEventCneter instance of EventCenterForMicroApp\n */\nexport function rebuildDataCenterSnapshot (microAppEventCneter: EventCenterForMicroApp): void {\n  for (const cb of microAppEventCneter.umdDataListeners!.global) {\n    microAppEventCneter.addGlobalDataListener(cb, cb.__AUTO_TRIGGER__)\n  }\n\n  for (const cb of microAppEventCneter.umdDataListeners!.normal) {\n    microAppEventCneter.addDataListener(cb, cb.__AUTO_TRIGGER__)\n  }\n}\n","import type { OptionsType, MicroAppConfigType, lifeCyclesType, plugins, fetchType } from '@micro-app/types'\nimport { defineElement } from './micro_app_element'\nimport preFetch, { getGlobalAssets } from './prefetch'\nimport { logError, logWarn, isFunction, isBrowser, isPlainObject } from './libs/utils'\nimport { EventCenterForBaseApp } from './interact'\nimport { initGloalEnv } from './libs/global_env'\n\nclass MicroApp extends EventCenterForBaseApp implements MicroAppConfigType {\n  tagName = 'micro-app'\n  shadowDOM?: boolean\n  destory?: boolean\n  inline?: boolean\n  disableScopecss?: boolean\n  disableSandbox?: boolean\n  macro?: boolean\n  lifeCycles?: lifeCyclesType\n  plugins?: plugins\n  fetch?: fetchType\n  preFetch = preFetch\n  start (options?: OptionsType) {\n    if (!isBrowser || !window.customElements) {\n      return logError('micro-app is not supported in this environment')\n    }\n\n    if (options?.tagName) {\n      if (/^micro-app(-\\S+)?/.test(options.tagName)) {\n        this.tagName = options.tagName\n      } else {\n        return logError(`${options.tagName} is invalid tagName`)\n      }\n    }\n\n    if (window.customElements.get(this.tagName)) {\n      return logWarn(`element ${this.tagName} is already defined`)\n    }\n\n    initGloalEnv()\n\n    if (options && isPlainObject(options)) {\n      this.shadowDOM = options.shadowDOM\n      this.destory = options.destory\n      this.inline = options.inline\n      this.disableScopecss = options.disableScopecss\n      this.disableSandbox = options.disableSandbox\n      this.macro = options.macro\n      if (isFunction(options.fetch)) this.fetch = options.fetch\n\n      if (isPlainObject(options.lifeCycles)) {\n        this.lifeCycles = options.lifeCycles\n      }\n\n      if (isPlainObject(options.plugins)) {\n        this.plugins = options.plugins\n      }\n\n      // load app assets when browser is idle\n      if (options.preFetchApps) {\n        preFetch(options.preFetchApps)\n      }\n\n      // load global assets when browser is idle\n      if (options.globalAssets) {\n        getGlobalAssets(options.globalAssets)\n      }\n    }\n\n    defineElement(this.tagName)\n  }\n}\n\nexport default new MicroApp()\n","import { isFunction } from '../libs/utils'\nimport microApp from '../micro_app'\n\n/**\n * fetch source of html, js, css\n * @param url source path\n * @param appName app name\n * @param config config of fetch\n */\nexport function fetchSource (url: string, appName: string | null = null, options = {}): Promise<string> {\n  if (isFunction(microApp.fetch)) {\n    return microApp.fetch!(url, options, appName)\n  }\n  return fetch(url, options).then((res) => {\n    return res.text()\n  })\n}\n","import type { AppInterface } from '@micro-app/types'\nimport { fetchSource } from './fetch'\nimport { logError, CompletionPath, pureCreateElement } from '../libs/utils'\nimport { extractLinkFromHtml, fetchLinksFromHtml } from './links'\nimport { extractScriptElement, fetchScriptsFromHtml } from './scripts'\nimport scopedCSS from './scoped_css'\n\n/**\n * transform html string to dom\n * @param str string dom\n */\nfunction getWrapElement (str: string): HTMLElement {\n  const wrapDiv = pureCreateElement('div')\n\n  wrapDiv.innerHTML = str\n\n  return wrapDiv\n}\n\n/**\n * Recursively process each child element\n * @param parent parent element\n * @param app app\n * @param microAppHead micro-app-head element\n */\nfunction flatChildren (\n  parent: HTMLElement,\n  app: AppInterface,\n  microAppHead: Element,\n): void {\n  const children = Array.from(parent.children)\n\n  children.length && children.forEach((child) => {\n    flatChildren(child as HTMLElement, app, microAppHead)\n  })\n\n  for (const dom of children) {\n    if (dom instanceof HTMLLinkElement) {\n      if (dom.hasAttribute('exclude')) {\n        parent.replaceChild(document.createComment('link element with exclude attribute ignored by micro-app'), dom)\n      } else if (app.scopecss && !dom.hasAttribute('ignore')) {\n        extractLinkFromHtml(dom, parent, app, microAppHead)\n      } else if (dom.hasAttribute('href')) {\n        dom.setAttribute('href', CompletionPath(dom.getAttribute('href')!, app.url))\n      }\n    } else if (dom instanceof HTMLStyleElement) {\n      if (dom.hasAttribute('exclude')) {\n        parent.replaceChild(document.createComment('style element with exclude attribute ignored by micro-app'), dom)\n      } else if (app.scopecss && !dom.hasAttribute('ignore')) {\n        microAppHead.appendChild(scopedCSS(dom, app.name))\n      }\n    } else if (dom instanceof HTMLScriptElement) {\n      extractScriptElement(dom, parent, app)\n    } else if (dom instanceof HTMLMetaElement || dom instanceof HTMLTitleElement) {\n      parent.removeChild(dom)\n    } else if (dom instanceof HTMLImageElement && dom.hasAttribute('src')) {\n      dom.setAttribute('src', CompletionPath(dom.getAttribute('src')!, app.url))\n    }\n  }\n}\n\n/**\n * Extract link and script, bind style scope\n * @param htmlStr html string\n * @param app app\n */\nfunction extractSourceDom (htmlStr: string, app: AppInterface) {\n  const wrapElement = getWrapElement(htmlStr)\n  const microAppHead = wrapElement.querySelector('micro-app-head')\n  const microAppBody = wrapElement.querySelector('micro-app-body')\n\n  if (!microAppHead || !microAppBody) {\n    const msg = `element ${microAppHead ? 'body' : 'head'} is missing`\n    app.onerror(new Error(msg))\n    return logError(msg, app.name)\n  }\n\n  flatChildren(wrapElement, app, microAppHead)\n\n  if (app.source.links.size) {\n    fetchLinksFromHtml(wrapElement, app, microAppHead)\n  } else {\n    app.onLoad(wrapElement)\n  }\n\n  if (app.source.scripts.size) {\n    fetchScriptsFromHtml(wrapElement, app)\n  } else {\n    app.onLoad(wrapElement)\n  }\n}\n\n/**\n * Get and format html\n * @param app app\n */\nexport default function extractHtml (app: AppInterface): void {\n  fetchSource(app.url, app.name, { cache: 'no-cache' }).then((htmlStr: string) => {\n    if (!htmlStr) {\n      const msg = 'html is empty, please check in detail'\n      app.onerror(new Error(msg))\n      return logError(msg, app.name)\n    }\n    htmlStr = htmlStr\n      .replace(/<head[^>]*>[\\s\\S]*?<\\/head>/i, (match) => {\n        return match\n          .replace(/<head/i, '<micro-app-head')\n          .replace(/<\\/head>/i, '</micro-app-head>')\n      })\n      .replace(/<body[^>]*>[\\s\\S]*?<\\/body>/i, (match) => {\n        return match\n          .replace(/<body/i, '<micro-app-body')\n          .replace(/<\\/body>/i, '</micro-app-body>')\n      })\n\n    extractSourceDom(htmlStr, app)\n  }).catch((e) => {\n    logError(`Failed to fetch data from ${app.url}, micro-app stop rendering`, app.name, e)\n    app.onLoadError(e)\n  })\n}\n","import type { Func } from '@micro-app/types'\nimport { isFunction } from '../libs/utils'\n\nconst boundedMap = new WeakMap<CallableFunction, boolean>()\nexport function isBoundedFunction (value: CallableFunction): boolean {\n  if (boundedMap.has(value)) {\n    return boundedMap.get(value)!\n  }\n\n  // bind function\n  const boundFunction = value.name.indexOf('bound ') === 0 && !value.hasOwnProperty('prototype')\n\n  boundedMap.set(value, boundFunction)\n\n  return boundFunction\n}\n\nconst constructorMap = new WeakMap<Func | FunctionConstructor, boolean>()\nfunction isConstructor (value: Func | FunctionConstructor) {\n  if (constructorMap.has(value)) {\n    return constructorMap.get(value)\n  }\n\n  const valueStr = value.toString()\n\n  const result = (\n    value.prototype &&\n    value.prototype.constructor === value &&\n    Object.getOwnPropertyNames(value.prototype).length > 1\n  ) ||\n    /^function\\s+[A-Z]/.test(valueStr) ||\n    /^class\\s+/.test(valueStr)\n\n  constructorMap.set(value, result)\n\n  return result\n}\n\nconst rawWindowMethodMap = new WeakMap<CallableFunction, CallableFunction>()\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport default function bindFunctionToRawWidow (rawWindow: Window, value: any): unknown {\n  if (rawWindowMethodMap.has(value)) {\n    return rawWindowMethodMap.get(value)\n  }\n\n  if (isFunction(value) && !isConstructor(value) && !isBoundedFunction(value)) {\n    const bindRawWindowValue = value.bind(rawWindow)\n\n    for (const key in value) {\n      bindRawWindowValue[key] = value[key]\n    }\n\n    if (value.hasOwnProperty('prototype') && !bindRawWindowValue.hasOwnProperty('prototype')) {\n      bindRawWindowValue.prototype = value.prototype\n    }\n\n    rawWindowMethodMap.set(value, bindRawWindowValue)\n    return bindRawWindowValue\n  }\n\n  return value\n}\n","import type { microWindowType } from '@micro-app/types'\nimport { getCurrentAppName, setCurrentAppName, logWarn, isFunction } from '../libs/utils'\nimport globalEnv from '../libs/global_env'\n\ntype MicroEventListener = EventListenerOrEventListenerObject & Record<string, any>\ntype timeInfo = {\n  handler: TimerHandler,\n  timeout?: number,\n  args: any[],\n}\n\n// document.onclick binding list, the binding function of each application is unique\nconst documentClickListMap = new Map<string, unknown>()\nlet hasRewriteDocumentOnClick = false\n/**\n * Rewrite document.onclick and execute it only once\n */\nfunction overwriteDocumentOnClick (): void {\n  hasRewriteDocumentOnClick = true\n  const descriptor = Object.getOwnPropertyDescriptor(document, 'onclick')\n  if (descriptor?.configurable === false) {\n    return logWarn('Cannot redefine document property onclick')\n  }\n  const rawOnClick = document.onclick\n  document.onclick = null\n  let hasDocumentClickInited = false\n\n  function onClickHandler (e: MouseEvent) {\n    documentClickListMap.forEach((f) => {\n      isFunction(f) && (f as Function).call(document, e)\n    })\n  }\n\n  Object.defineProperty(document, 'onclick', {\n    configurable: false,\n    enumerable: true,\n    get () {\n      const appName = getCurrentAppName()\n      return appName ? documentClickListMap.get(appName) : documentClickListMap.get('base')\n    },\n    set (f: GlobalEventHandlers['onclick']) {\n      const appName = getCurrentAppName()\n      if (appName) {\n        documentClickListMap.set(appName, f)\n      } else {\n        documentClickListMap.set('base', f)\n      }\n\n      if (!hasDocumentClickInited && isFunction(f)) {\n        hasDocumentClickInited = true\n        globalEnv.rawDocumentAddEventListener.call(globalEnv.rawDocument, 'click', onClickHandler, false)\n      }\n    }\n  })\n\n  if (rawOnClick) {\n    document.onclick = rawOnClick\n  }\n}\n\n/**\n * The document event is globally, we need to clear these event bindings when micro application unmounted\n */\nconst documentEventListenerMap = new Map<string, Map<string, Set<MicroEventListener>>>()\nexport function effectDocumentEvent (): void {\n  const {\n    rawDocument,\n    rawDocumentAddEventListener,\n    rawDocumentRemoveEventListener,\n  } = globalEnv\n\n  if (!hasRewriteDocumentOnClick) {\n    overwriteDocumentOnClick()\n  }\n\n  document.addEventListener = function (\n    type: string,\n    listener: MicroEventListener,\n    options?: boolean | AddEventListenerOptions\n  ): void {\n    const appName = getCurrentAppName()\n    if (appName) {\n      const appListenersMap = documentEventListenerMap.get(appName)\n      if (appListenersMap) {\n        const appListenerList = appListenersMap.get(type)\n        if (appListenerList) {\n          appListenerList.add(listener)\n        } else {\n          appListenersMap.set(type, new Set([listener]))\n        }\n      } else {\n        documentEventListenerMap.set(appName, new Map([[type, new Set([listener])]]))\n      }\n      listener && (listener.__MICRO_MARK_OPTIONS__ = options)\n    }\n    rawDocumentAddEventListener.call(rawDocument, type, listener, options)\n  }\n\n  document.removeEventListener = function (\n    type: string,\n    listener: MicroEventListener,\n    options?: boolean | AddEventListenerOptions,\n  ): void {\n    const appName = getCurrentAppName()\n    if (appName) {\n      const appListenersMap = documentEventListenerMap.get(appName)\n      if (appListenersMap) {\n        const appListenerList = appListenersMap.get(type)\n        if (appListenerList?.size && appListenerList.has(listener)) {\n          appListenerList.delete(listener)\n        }\n      }\n    }\n    rawDocumentRemoveEventListener.call(rawDocument, type, listener, options)\n  }\n}\n\n// Clear the document event agent\nexport function releaseEffectDocumentEvent (): void {\n  document.addEventListener = globalEnv.rawDocumentAddEventListener\n  document.removeEventListener = globalEnv.rawDocumentRemoveEventListener\n}\n\n/**\n * Format event name\n * @param type event name\n * @param microWindow micro window\n */\nfunction formatEventType (type: string, microWindow: microWindowType): string {\n  if (type === 'unmount') {\n    return `unmount-${microWindow.__MICRO_APP_NAME__}`\n  }\n  return type\n}\n\n/**\n * Rewrite side-effect events\n * @param microWindow micro window\n */\nexport default function effect (microWindow: microWindowType): Record<string, CallableFunction> {\n  const appName = microWindow.__MICRO_APP_NAME__\n  const eventListenerMap = new Map<string, Set<MicroEventListener>>()\n  const intervalIdMap = new Map<number, timeInfo>()\n  const timeoutIdMap = new Map<number, timeInfo>()\n  const {\n    rawWindow,\n    rawDocument,\n    rawWindowAddEventListener,\n    rawWindowRemoveEventListener,\n    rawSetInterval,\n    rawSetTimeout,\n    rawClearInterval,\n    rawClearTimeout,\n    rawDocumentRemoveEventListener,\n  } = globalEnv\n\n  // listener may be null, e.g test-passive\n  microWindow.addEventListener = function (\n    type: string,\n    listener: MicroEventListener,\n    options?: boolean | AddEventListenerOptions,\n  ): void {\n    type = formatEventType(type, microWindow)\n    const listenerList = eventListenerMap.get(type)\n    if (listenerList) {\n      listenerList.add(listener)\n    } else {\n      eventListenerMap.set(type, new Set([listener]))\n    }\n    listener && (listener.__MICRO_MARK_OPTIONS__ = options)\n    rawWindowAddEventListener.call(rawWindow, type, listener, options)\n  }\n\n  microWindow.removeEventListener = function (\n    type: string,\n    listener: MicroEventListener,\n    options?: boolean | AddEventListenerOptions,\n  ): void {\n    type = formatEventType(type, microWindow)\n    const listenerList = eventListenerMap.get(type)\n    if (listenerList?.size && listenerList.has(listener)) {\n      listenerList.delete(listener)\n    }\n    rawWindowRemoveEventListener.call(rawWindow, type, listener, options)\n  }\n\n  microWindow.setInterval = function (\n    handler: TimerHandler,\n    timeout?: number,\n    ...args: any[]\n  ): number {\n    const intervalId = rawSetInterval.call(rawWindow, handler, timeout, ...args)\n    intervalIdMap.set(intervalId, { handler, timeout, args })\n    return intervalId\n  }\n\n  microWindow.setTimeout = function (\n    handler: TimerHandler,\n    timeout?: number,\n    ...args: any[]\n  ): number {\n    const timeoutId = rawSetTimeout.call(rawWindow, handler, timeout, ...args)\n    timeoutIdMap.set(timeoutId, { handler, timeout, args })\n    return timeoutId\n  }\n\n  microWindow.clearInterval = function (intervalId: number) {\n    intervalIdMap.delete(intervalId)\n    rawClearInterval.call(rawWindow, intervalId)\n  }\n\n  microWindow.clearTimeout = function (timeoutId: number) {\n    timeoutIdMap.delete(timeoutId)\n    rawClearTimeout.call(rawWindow, timeoutId)\n  }\n\n  const umdWindowListenerMap = new Map<string, Set<MicroEventListener>>()\n  const umdDocumentListenerMap = new Map<string, Set<MicroEventListener>>()\n  let umdIntervalIdMap = new Map<number, timeInfo>()\n  let umdTimeoutIdMap = new Map<number, timeInfo>()\n  let umdOnClickHandler: unknown\n\n  // record event and timer before exec umdMountHook\n  const recordUmdEffect = () => {\n    // record window event\n    eventListenerMap.forEach((listenerList, type) => {\n      if (listenerList.size) {\n        umdWindowListenerMap.set(type, new Set(listenerList))\n      }\n    })\n\n    // record timers\n    if (intervalIdMap.size) {\n      umdIntervalIdMap = new Map(intervalIdMap)\n    }\n\n    if (timeoutIdMap.size) {\n      umdTimeoutIdMap = new Map(timeoutIdMap)\n    }\n\n    // record onclick handler\n    umdOnClickHandler = documentClickListMap.get(appName)\n\n    // record document event\n    const documentAppListenersMap = documentEventListenerMap.get(appName)\n    if (documentAppListenersMap) {\n      documentAppListenersMap.forEach((listenerList, type) => {\n        if (listenerList.size) {\n          umdDocumentListenerMap.set(type, new Set(listenerList))\n        }\n      })\n    }\n  }\n\n  // rebuild event and timer before remount umd app\n  const rebuildUmdEffect = () => {\n    // rebuild window event\n    umdWindowListenerMap.forEach((listenerList, type) => {\n      for (const listener of listenerList) {\n        microWindow.addEventListener(type, listener, listener?.__MICRO_MARK_OPTIONS__)\n      }\n    })\n\n    // rebuild timer\n    umdIntervalIdMap.forEach((info: timeInfo) => {\n      microWindow.setInterval(info.handler, info.timeout, ...info.args)\n    })\n\n    umdTimeoutIdMap.forEach((info: timeInfo) => {\n      microWindow.setTimeout(info.handler, info.timeout, ...info.args)\n    })\n\n    // rebuild onclick event\n    umdOnClickHandler && documentClickListMap.set(appName, umdOnClickHandler)\n\n    // rebuild document event\n    setCurrentAppName(appName)\n    umdDocumentListenerMap.forEach((listenerList, type) => {\n      for (const listener of listenerList) {\n        document.addEventListener(type, listener, listener?.__MICRO_MARK_OPTIONS__)\n      }\n    })\n    setCurrentAppName(null)\n  }\n\n  // release all event listener & interval & timeout when unmount app\n  const releaseEffect = () => {\n    // Clear window binding events\n    if (eventListenerMap.size) {\n      eventListenerMap.forEach((listenerList, type) => {\n        for (const listener of listenerList) {\n          rawWindowRemoveEventListener.call(rawWindow, type, listener)\n        }\n      })\n      eventListenerMap.clear()\n    }\n\n    // Clear timers\n    if (intervalIdMap.size) {\n      intervalIdMap.forEach((_, intervalId: number) => {\n        rawClearInterval.call(rawWindow, intervalId)\n      })\n      intervalIdMap.clear()\n    }\n\n    if (timeoutIdMap.size) {\n      timeoutIdMap.forEach((_, timeoutId: number) => {\n        rawClearTimeout.call(rawWindow, timeoutId)\n      })\n      timeoutIdMap.clear()\n    }\n\n    // Clear the function bound by micro application through document.onclick\n    documentClickListMap.delete(appName)\n\n    // Clear document binding event\n    const documentAppListenersMap = documentEventListenerMap.get(appName)\n    if (documentAppListenersMap) {\n      documentAppListenersMap.forEach((listenerList, type) => {\n        for (const listener of listenerList) {\n          rawDocumentRemoveEventListener.call(rawDocument, type, listener)\n        }\n      })\n      documentAppListenersMap.clear()\n    }\n  }\n\n  return {\n    recordUmdEffect,\n    rebuildUmdEffect,\n    releaseEffect,\n  }\n}\n","import type { SandBoxInterface, microWindowType } from '@micro-app/types'\nimport bindFunctionToRawWidow from './bind_function'\nimport {\n  unique,\n  setCurrentAppName,\n  defer,\n  getEffectivePath,\n  removeDomScope,\n  isString,\n  isPlainObject,\n  isArray,\n} from '../libs/utils'\nimport effect, { effectDocumentEvent, releaseEffectDocumentEvent } from './effect'\nimport {\n  EventCenterForMicroApp,\n  recordDataCenterSnapshot,\n  rebuildDataCenterSnapshot,\n} from '../interact'\nimport microApp from '../micro_app'\nimport globalEnv from '../libs/global_env'\n\n/* eslint-disable camelcase */\ntype injectDataType = {\n  __MICRO_APP_ENVIRONMENT__: boolean\n  __MICRO_APP_NAME__: string\n  __MICRO_APP_PUBLIC_PATH__: string\n  __MICRO_APP_BASE_URL__: string\n  __MICRO_APP_BASE_ROUTE__: string\n  __MICRO_APP_UMDMODE__: boolean\n  microApp: EventCenterForMicroApp\n  rawWindow: Window\n  rawDocument: Document\n  removeDomScope: () => void\n}\n\n// Variables that can escape to rawWindow\nconst staticEscapeProperties: PropertyKey[] = [\n  'System',\n  '__cjsWrapper',\n  '__REACT_ERROR_OVERLAY_GLOBAL_HOOK__',\n]\n\n// Variables that can only assigned to rawWindow\nconst escapeSetterKeyList: PropertyKey[] = [\n  'location',\n]\n\nconst unscopables = {\n  undefined: true,\n  Array: true,\n  Object: true,\n  String: true,\n  Boolean: true,\n  Math: true,\n  Number: true,\n  Symbol: true,\n  parseFloat: true,\n  Float32Array: true,\n}\n\n/**\n * macro task to solve the rendering problem of vue3\n */\nlet macroTimer: number\nfunction macroTask (fn: TimerHandler): void {\n  if (macroTimer) clearTimeout(macroTimer)\n  macroTimer = setTimeout(fn, 0)\n}\n\nexport default class SandBox implements SandBoxInterface {\n  static activeCount = 0 // number of active sandbox\n  active = false // sandbox state\n  proxyWindow: WindowProxy & injectDataType\n  // @ts-ignore\n  recordUmdEffect: CallableFunction\n  // @ts-ignore\n  rebuildUmdEffect: CallableFunction\n  // @ts-ignore\n  releaseEffect: CallableFunction\n  // Scoped global Properties(Properties that can only get and set in microWindow, will not escape to rawWindow)\n  scopeProperties: PropertyKey[] = ['webpackJsonp']\n  // Properties that can be escape to rawWindow\n  escapeProperties: PropertyKey[] = []\n  microWindow = {} as Window & injectDataType // Proxy target\n  injectedKeys = new Set<PropertyKey>() // Properties newly added to microWindow\n  escapeKeys = new Set<PropertyKey>() // Properties escape to rawWindow, cleared when unmount\n  recordUmdinjectedValues?: Map<PropertyKey, unknown>// record injected values before the first execution of umdHookMount and rebuild before remount umd app\n\n  constructor (appName: string, url: string, macro: boolean) {\n    const rawWindow = globalEnv.rawWindow\n    const rawDocument = globalEnv.rawDocument\n    const descriptorTargetMap = new Map<PropertyKey, 'target' | 'rawWindow'>()\n    const hasOwnProperty = (key: PropertyKey) => this.microWindow.hasOwnProperty(key) || rawWindow.hasOwnProperty(key)\n    // get scopeProperties and escapeProperties from plugins\n    this.getScopeProperties(appName)\n    // inject global properties\n    this.inject(this.microWindow, appName, url)\n    // Rewrite global event listener & timeout\n    Object.assign(this, effect(this.microWindow))\n\n    this.proxyWindow = new Proxy(this.microWindow, {\n      get: (target: microWindowType, key: PropertyKey): unknown => {\n        if (key === Symbol.unscopables) return unscopables\n\n        if (['window', 'self', 'globalThis'].includes(key as string)) {\n          return this.proxyWindow\n        }\n\n        if (key === 'top' || key === 'parent') {\n          if (rawWindow === rawWindow.parent) { // not in iframe\n            return this.proxyWindow\n          }\n          return Reflect.get(rawWindow, key) // iframe\n        }\n\n        if (key === 'hasOwnProperty') return hasOwnProperty\n\n        if (key === 'document' || key === 'eval') {\n          if (this.active) {\n            setCurrentAppName(appName)\n            ;(macro ? macroTask : defer)(() => setCurrentAppName(null))\n          }\n          switch (key) {\n            case 'document':\n              return rawDocument\n            case 'eval':\n              return eval\n          }\n        }\n\n        if (Reflect.has(target, key)) {\n          return Reflect.get(target, key)\n        }\n\n        if (\n          this.scopeProperties.includes(key) ||\n          (isString(key) && /^__MICRO_APP_/.test(key))\n        ) {\n          return Reflect.get(target, key)\n        }\n\n        const rawValue = Reflect.get(rawWindow, key)\n\n        return bindFunctionToRawWidow(rawWindow, rawValue)\n      },\n      set: (target: microWindowType, key: PropertyKey, value: unknown): boolean => {\n        if (this.active) {\n          if (escapeSetterKeyList.includes(key)) {\n            Reflect.set(rawWindow, key, value)\n          } else if (\n            !target.hasOwnProperty(key) &&\n            rawWindow.hasOwnProperty(key) &&\n            !this.scopeProperties.includes(key)\n          ) {\n            const descriptor = Object.getOwnPropertyDescriptor(rawWindow, key)\n            const { writable, configurable, enumerable } = descriptor!\n            if (writable) {\n              Object.defineProperty(target, key, {\n                configurable,\n                enumerable,\n                writable,\n                value,\n              })\n              this.injectedKeys.add(key)\n            }\n          } else {\n            Reflect.set(target, key, value)\n            this.injectedKeys.add(key)\n          }\n\n          if (\n            (\n              this.escapeProperties.includes(key) ||\n              (staticEscapeProperties.includes(key) && !Reflect.has(rawWindow, key))\n            ) &&\n            !this.scopeProperties.includes(key)\n          ) {\n            Reflect.set(rawWindow, key, value)\n            this.escapeKeys.add(key)\n          }\n        }\n\n        return true\n      },\n      has: (target: microWindowType, key: PropertyKey): boolean => {\n        if (this.scopeProperties.includes(key)) return key in target\n        return key in unscopables || key in target || key in rawWindow\n      },\n      getOwnPropertyDescriptor: (target: microWindowType, key: PropertyKey): PropertyDescriptor|undefined => {\n        if (target.hasOwnProperty(key)) {\n          descriptorTargetMap.set(key, 'target')\n          return Object.getOwnPropertyDescriptor(target, key)\n        }\n\n        if (rawWindow.hasOwnProperty(key)) {\n          descriptorTargetMap.set(key, 'rawWindow')\n          const descriptor = Object.getOwnPropertyDescriptor(rawWindow, key)\n          if (descriptor && !descriptor.configurable) {\n            descriptor.configurable = true\n          }\n          return descriptor\n        }\n\n        return undefined\n      },\n      defineProperty: (target: microWindowType, key: PropertyKey, value: PropertyDescriptor): boolean => {\n        const from = descriptorTargetMap.get(key)\n        if (from === 'rawWindow') {\n          return Reflect.defineProperty(rawWindow, key, value)\n        }\n        return Reflect.defineProperty(target, key, value)\n      },\n      ownKeys: (target: microWindowType): Array<string | symbol> => {\n        return unique(Reflect.ownKeys(rawWindow).concat(Reflect.ownKeys(target)))\n      },\n      deleteProperty: (target: microWindowType, key: PropertyKey): boolean => {\n        if (target.hasOwnProperty(key)) {\n          if (this.escapeKeys.has(key)) {\n            Reflect.deleteProperty(rawWindow, key)\n          }\n          return Reflect.deleteProperty(target, key)\n        }\n        return true\n      },\n    })\n  }\n\n  start (baseroute: string): void {\n    if (!this.active) {\n      this.active = true\n      this.microWindow.__MICRO_APP_BASE_ROUTE__ = this.microWindow.__MICRO_APP_BASE_URL__ = baseroute\n      if (globalEnv.rawWindow._babelPolyfill) globalEnv.rawWindow._babelPolyfill = false\n      if (++SandBox.activeCount === 1) {\n        effectDocumentEvent()\n      }\n    }\n  }\n\n  stop (): void {\n    if (this.active) {\n      this.active = false\n      this.releaseEffect()\n      this.microWindow.microApp.clearDataListener()\n      this.microWindow.microApp.clearGlobalDataListener()\n\n      this.injectedKeys.forEach((key: PropertyKey) => {\n        Reflect.deleteProperty(this.microWindow, key)\n      })\n      this.injectedKeys.clear()\n\n      this.escapeKeys.forEach((key: PropertyKey) => {\n        Reflect.deleteProperty(globalEnv.rawWindow, key)\n      })\n      this.escapeKeys.clear()\n\n      if (--SandBox.activeCount === 0) {\n        releaseEffectDocumentEvent()\n      }\n    }\n  }\n\n  // record umd snapshot before the first execution of umdHookMount\n  recordUmdSnapshot (): void {\n    this.microWindow.__MICRO_APP_UMD_MODE__ = true\n    this.recordUmdEffect()\n    recordDataCenterSnapshot(this.microWindow.microApp)\n\n    this.recordUmdinjectedValues = new Map<PropertyKey, unknown>()\n    this.injectedKeys.forEach((key: PropertyKey) => {\n      this.recordUmdinjectedValues!.set(key, Reflect.get(this.microWindow, key))\n    })\n  }\n\n  // rebuild umd snapshot before remount umd app\n  rebuildUmdSnapshot (): void {\n    this.recordUmdinjectedValues!.forEach((value: unknown, key: PropertyKey) => {\n      Reflect.set(this.proxyWindow, key, value)\n    })\n    this.rebuildUmdEffect()\n    rebuildDataCenterSnapshot(this.microWindow.microApp)\n  }\n\n  /**\n   * get scopeProperties and escapeProperties from plugins\n   * @param appName app name\n   */\n  getScopeProperties (appName: string): void {\n    if (!isPlainObject(microApp.plugins)) return\n\n    if (isArray(microApp.plugins!.global)) {\n      for (const plugin of microApp.plugins!.global) {\n        if (isPlainObject(plugin)) {\n          if (isArray(plugin.scopeProperties)) {\n            this.scopeProperties = this.scopeProperties.concat(plugin.scopeProperties!)\n          }\n          if (isArray(plugin.escapeProperties)) {\n            this.escapeProperties = this.escapeProperties.concat(plugin.escapeProperties!)\n          }\n        }\n      }\n    }\n\n    if (isArray(microApp.plugins!.modules?.[appName])) {\n      for (const plugin of microApp.plugins!.modules![appName]) {\n        if (isPlainObject(plugin)) {\n          if (isArray(plugin.scopeProperties)) {\n            this.scopeProperties = this.scopeProperties.concat(plugin.scopeProperties!)\n          }\n          if (isArray(plugin.escapeProperties)) {\n            this.escapeProperties = this.escapeProperties.concat(plugin.escapeProperties!)\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * inject global properties to microWindow\n   * @param microWindow micro window\n   * @param appName app name\n   * @param url app url\n   */\n  inject (microWindow: microWindowType, appName: string, url: string): void {\n    microWindow.__MICRO_APP_ENVIRONMENT__ = true\n    microWindow.__MICRO_APP_NAME__ = appName\n    microWindow.__MICRO_APP_PUBLIC_PATH__ = getEffectivePath(url)\n    microWindow.microApp = new EventCenterForMicroApp(appName)\n    microWindow.rawWindow = globalEnv.rawWindow\n    microWindow.rawDocument = globalEnv.rawDocument\n    microWindow.removeDomScope = removeDomScope\n  }\n}\n","import type {\n  AppInterface,\n  sourceType,\n  SandBoxInterface,\n  sourceLinkInfo,\n  sourceScriptInfo,\n  Func,\n} from '@micro-app/types'\nimport extractHtml from './source'\nimport { execScripts } from './source/scripts'\nimport { appStatus, lifeCycles } from './constants'\nimport SandBox from './sandbox'\nimport { defer, isFunction, cloneNode, isBoolean, isNull } from './libs/utils'\nimport dispatchLifecyclesEvent, { dispatchUnmountToMicroApp } from './interact/lifecycles_event'\nimport globalEnv from './libs/global_env'\n\n// micro app instances\nexport const appInstanceMap = new Map<string, AppInterface>()\n\n// params of CreateApp\nexport interface CreateAppParam {\n  name: string\n  url: string\n  scopecss: boolean\n  useSandbox: boolean\n  macro?: boolean\n  inline?: boolean\n  baseroute?: string\n  container?: HTMLElement | ShadowRoot\n}\n\nexport default class CreateApp implements AppInterface {\n  private status: string = appStatus.NOT_LOADED\n  private loadSourceLevel: -1|0|1|2 = 0\n  private umdHookMount: Func | null = null\n  private umdHookunMount: Func | null = null\n  private libraryName: string | null = null\n  private umdMode = false\n  isPrefetch = false\n  name: string\n  url: string\n  container: HTMLElement | ShadowRoot | null = null\n  inline: boolean\n  scopecss: boolean\n  useSandbox: boolean\n  macro = false\n  baseroute = ''\n  source: sourceType\n  sandBox: SandBoxInterface | null = null\n\n  constructor ({ name, url, container, inline, scopecss, useSandbox, macro, baseroute }: CreateAppParam) {\n    this.container = container ?? null\n    this.inline = inline ?? false\n    this.baseroute = baseroute ?? ''\n    // optional during initðŸ‘†\n    this.name = name\n    this.url = url\n    this.useSandbox = useSandbox\n    this.scopecss = this.useSandbox && scopecss\n    this.macro = macro ?? false\n    this.source = {\n      links: new Map<string, sourceLinkInfo>(),\n      scripts: new Map<string, sourceScriptInfo>(),\n    }\n    this.loadSourceCode()\n    if (this.useSandbox) {\n      this.sandBox = new SandBox(name, url, this.macro)\n    }\n  }\n\n  // Load resources\n  loadSourceCode (): void {\n    this.status = appStatus.LOADING_SOURCE_CODE\n    extractHtml(this)\n  }\n\n  /**\n   * When resource is loaded, mount app if it is not prefetch or unmount\n   */\n  onLoad (html: HTMLElement): void {\n    if (++this.loadSourceLevel === 2) {\n      this.source.html = html\n\n      if (this.isPrefetch || appStatus.UNMOUNT === this.status) return\n\n      this.status = appStatus.LOAD_SOURCE_FINISHED\n\n      this.mount()\n    }\n  }\n\n  /**\n   * Error loading HTML\n   * @param e Error\n   */\n  onLoadError (e: Error): void {\n    this.loadSourceLevel = -1\n    if (appStatus.UNMOUNT !== this.status) {\n      this.onerror(e)\n      this.status = appStatus.LOAD_SOURCE_ERROR\n    }\n  }\n\n  /**\n   * mount app\n   * @param container app container\n   * @param inline js runs in inline mode\n   * @param baseroute route prefix, default is ''\n   */\n  mount (\n    container?: HTMLElement | ShadowRoot,\n    inline?: boolean,\n    baseroute?: string,\n  ): void {\n    if (isBoolean(inline) && inline !== this.inline) {\n      this.inline = inline\n    }\n\n    this.container = this.container ?? container!\n    this.baseroute = baseroute ?? this.baseroute\n\n    if (this.loadSourceLevel !== 2) {\n      this.status = appStatus.LOADING_SOURCE_CODE\n      return\n    }\n\n    dispatchLifecyclesEvent(\n      this.container as HTMLElement,\n      this.name,\n      lifeCycles.BEFOREMOUNT,\n    )\n\n    this.status = appStatus.MOUNTING\n\n    cloneNode(this.source.html as Element, this.container as Element, !this.umdMode)\n\n    this.sandBox?.start(this.baseroute)\n    if (!this.umdMode) {\n      execScripts(this.source.scripts, this, (isFinished: boolean) => {\n        if (isNull(this.umdHookMount)) {\n          const { mount, unmount } = this.getUmdLibraryHooks()\n          // if mount & unmount is function, the sub app is umd mode\n          if (isFunction(mount) && isFunction(unmount)) {\n            this.umdHookMount = mount as Func\n            this.umdHookunMount = unmount as Func\n            this.umdMode = true\n            this.sandBox?.recordUmdSnapshot()\n            this.umdHookMount()\n          }\n        }\n        if (isFinished === true) {\n          this.dispatchMountedEvent()\n        }\n      })\n    } else {\n      this.sandBox?.rebuildUmdSnapshot()\n      this.umdHookMount!()\n      this.dispatchMountedEvent()\n    }\n  }\n\n  /**\n   * dispatch mounted event when app run finished\n   */\n  dispatchMountedEvent (): void {\n    if (appStatus.UNMOUNT !== this.status) {\n      this.status = appStatus.MOUNTED\n      defer(() => {\n        if (appStatus.UNMOUNT !== this.status) {\n          dispatchLifecyclesEvent(\n            this.container as HTMLElement,\n            this.name,\n            lifeCycles.MOUNTED,\n          )\n        }\n      })\n    }\n  }\n\n  /**\n   * unmount app\n   * @param destory completely destroy, delete cache resources\n   */\n  unmount (destory: boolean): void {\n    if (this.status === appStatus.LOAD_SOURCE_ERROR) {\n      destory = true\n    }\n    this.status = appStatus.UNMOUNT\n    dispatchLifecyclesEvent(\n      this.container as HTMLElement,\n      this.name,\n      lifeCycles.UNMOUNT,\n    )\n    // Send an unmount event to the micro app or call umd unmount hook\n    // before the sandbox is cleared & after the unmount lifecycle is executed\n    this.umdHookunMount && this.umdHookunMount()\n    dispatchUnmountToMicroApp(this.name)\n    this.sandBox?.stop()\n\n    // actions for completely destroy\n    if (destory) {\n      if (!this.useSandbox && this.umdMode) {\n        delete window[this.libraryName as any]\n      }\n      appInstanceMap.delete(this.name)\n    } else if (this.umdMode) {\n      /**\n      * In umd mode, ui frameworks will no longer create style elements to head in lazy load page when render again, so we should save container to keep these elements\n      */\n      cloneNode(this.container as Element, this.source.html as Element, false)\n    }\n\n    this.container = null\n  }\n\n  /**\n   * app rendering error\n   * @param e Error\n   */\n  onerror (e: Error): void {\n    dispatchLifecyclesEvent(\n      this.container as HTMLElement,\n      this.name,\n      lifeCycles.ERROR,\n      e,\n    )\n  }\n\n  // get app status\n  getAppStatus (): string {\n    return this.status\n  }\n\n  // get umd library, if it not exist, return empty object\n  private getUmdLibraryHooks (): Record<string, unknown> {\n    // after execScripts, the app maybe unmounted\n    if (appStatus.UNMOUNT !== this.status) {\n      const global = (this.sandBox?.proxyWindow ?? globalEnv.rawWindow) as any\n      this.libraryName = (this.container instanceof ShadowRoot ? this.container.host : this.container)!.getAttribute('library') || `micro-app-${this.name}`\n      // do not use isObject\n      return typeof global[this.libraryName] === 'object' ? global[this.libraryName] : {}\n    }\n\n    return {}\n  }\n}\n","import type { prefetchParamList, prefetchParam, globalAssetsType } from '@micro-app/types'\nimport CreateApp, { appInstanceMap } from './create_app'\nimport { requestIdleCallback, formatURL, promiseStream, logError, isBrowser, isArray, isPlainObject, isString, isFunction } from './libs/utils'\nimport { fetchSource } from './source/fetch'\nimport { globalLinks } from './source/links'\nimport { globalScripts } from './source/scripts'\nimport microApp from './micro_app'\n\nfunction filterPreFetchTarget<T extends prefetchParam> (apps: T[]): T[] {\n  const validApps: T[] = []\n\n  if (isArray(apps)) {\n    apps.forEach((item) => {\n      item.url = formatURL(item.url, item.name)\n      if (\n        isPlainObject(item) &&\n        isString(item.name) &&\n        item.url &&\n        !appInstanceMap.has(item.name)\n      ) {\n        validApps.push(item)\n      }\n    })\n  }\n\n  return validApps\n}\n\n/**\n * preFetch([\n *  {\n *    name: string,\n *    url: string,\n *    disableScopecss?: boolean,\n *    disableSandbox?: boolean,\n *    macro?: boolean,\n *  },\n *  ...\n * ])\n * Note:\n *  1: preFetch is asynchronous and is performed only when the browser is idle\n *  2: disableScopecss, disableSandbox, macro must be same with micro-app element, if conflict, the one who executes first shall prevail\n * @param apps micro apps\n */\nexport default function preFetch (apps: prefetchParamList): void {\n  if (!isBrowser) {\n    return logError('preFetch is only supported in browser environment')\n  }\n  requestIdleCallback(() => {\n    if (isFunction(apps)) apps = (apps as Function)()\n\n    filterPreFetchTarget(apps as prefetchParam[]).forEach((item) => {\n      const app = new CreateApp({\n        name: item.name,\n        url: item.url,\n        scopecss: !(item.disableScopecss ?? microApp.disableScopecss),\n        useSandbox: !(item.disableSandbox ?? microApp.disableSandbox),\n        macro: item.macro ?? microApp.macro,\n      })\n\n      app.isPrefetch = true\n      appInstanceMap.set(item.name, app)\n    })\n  })\n}\n\n/**\n * load global assets into cache\n * @param assets global assets of js, css\n */\nexport function getGlobalAssets (assets: globalAssetsType): void {\n  if (isPlainObject(assets)) {\n    requestIdleCallback(() => {\n      if (isArray(assets.js)) {\n        const effectiveJs = assets.js!.filter((path) => isString(path) && path.includes('.js') && !globalScripts.has(path))\n\n        const fetchJSPromise: Array<Promise<string>> = []\n        effectiveJs.forEach((path) => {\n          fetchJSPromise.push(fetchSource(path))\n        })\n\n        // fetch js with stream\n        promiseStream<string>(fetchJSPromise, (res: {data: string, index: number}) => {\n          const path = effectiveJs[res.index]\n          if (!globalScripts.has(path)) {\n            globalScripts.set(path, res.data)\n          }\n        }, (err: {error: Error, index: number}) => {\n          logError(err)\n        })\n      }\n\n      if (isArray(assets.css)) {\n        const effectiveCss = assets.css!.filter((path) => isString(path) && path.includes('.css') && !globalLinks.has(path))\n\n        const fetchCssPromise: Array<Promise<string>> = []\n        effectiveCss.forEach((path) => {\n          fetchCssPromise.push(fetchSource(path))\n        })\n\n        // fetch css with stream\n        promiseStream<string>(fetchCssPromise, (res: {data: string, index: number}) => {\n          const path = effectiveCss[res.index]\n          if (!globalLinks.has(path)) {\n            globalLinks.set(path, res.data)\n          }\n        }, (err: {error: Error, index: number}) => {\n          logError(err)\n        })\n      }\n    })\n  }\n}\n"],"names":["eventHandler"],"mappings":"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"}